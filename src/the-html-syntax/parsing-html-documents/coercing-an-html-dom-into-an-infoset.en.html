  <h4>Coercing an HTML DOM into an infoset</h4>

  <p>When an application uses an <span>HTML parser</span> in conjunction with an XML pipeline, it is
  possible that the constructed DOM is not compatible with the XML tool chain in certain subtle
  ways. For example, an XML toolchain might not be able to represent attributes with the name <code
  data-x="">xmlns</code>, since they conflict with the Namespaces in XML syntax. There is also some
  data that the <span>HTML parser</span> generates that isn't included in the DOM itself. This
  section specifies some rules for handling these issues.</p>

  <p>If the XML API being used doesn't support DOCTYPEs, the tool may drop DOCTYPEs altogether.</p>

  <p>If the XML API doesn't support attributes in no namespace that are named "<code
  data-x="">xmlns</code>", attributes whose names start with "<code data-x="">xmlns:</code>", or
  attributes in the <span>XMLNS namespace</span>, then the tool may drop such attributes.</p>

  <p>The tool may annotate the output with any namespace declarations required for proper
  operation.</p>

  <p>If the XML API being used restricts the allowable characters in the local names of elements and
  attributes, then the tool may map all element and attribute local names that the API wouldn't
  support to a set of names that <em>are</em> allowed, by replacing any character that isn't
  supported with the uppercase letter U and the six digits of the character's code point when
  expressed in hexadecimal, using digits 0-9 and capital letters A-F as the symbols, in increasing
  numeric order.</p>

  <p class="example">For example, the element name <code data-x="">foo&lt;bar</code>, which can be
  output by the <span>HTML parser</span>, though it is neither a legal HTML element name nor a
  well-formed XML element name, would be converted into <code data-x="">fooU00003Cbar</code>, which
  <em>is</em> a well-formed XML element name (though it's still not legal in HTML by any means).</p>

  <p class="example">As another example, consider the attribute <code data-x="">xlink:href</code>.
  Used on a MathML element, it becomes, after being <span data-x="adjust foreign
  attributes">adjusted</span>, an attribute with a prefix "<code data-x="">xlink</code>" and a local
  name "<code data-x="">href</code>". However, used on an HTML element, it becomes an attribute with
  no prefix and the local name "<code data-x="">xlink:href</code>", which is not a valid NCName, and
  thus might not be accepted by an XML API. It could thus get converted, becoming "<code
  data-x="">xlinkU00003Ahref</code>".</p>

  <p class="note">The resulting names from this conversion conveniently can't clash with any
  attribute generated by the <span>HTML parser</span>, since those are all either lowercase or those
  listed in the <span>adjust foreign attributes</span> algorithm's table.</p>

  <p>If the XML API restricts comments from having two consecutive U+002D HYPHEN-MINUS characters
  (--), the tool may insert a single U+0020 SPACE character between any such offending
  characters.</p>

  <p>If the XML API restricts comments from ending in a U+002D HYPHEN-MINUS character (-), the tool
  may insert a single U+0020 SPACE character at the end of such comments.</p>

  <p>If the XML API restricts allowed characters in character data, attribute values, or comments,
  the tool may replace any U+000C FORM FEED (FF) character with a U+0020 SPACE character, and any
  other literal non-XML character with a U+FFFD REPLACEMENT CHARACTER.</p>

  <p>If the tool has no way to convey out-of-band information, then the tool may drop the following
  information:</p>

  <ul>

   <li>Whether the document is set to <i data-x="no-quirks mode">no-quirks mode</i>, <i data-x="limited-quirks mode">limited-quirks mode</i>, or
   <i data-x="quirks mode">quirks mode</i></li>

   <li>The association between form controls and forms that aren't their nearest <code>form</code>
   element ancestor (use of the <span><code>form</code> element pointer</span> in the parser)</li>

   <li>The <span>template contents</span> of any <code>template</code> elements.</li>

  </ul>

  <p class="note">The mutations allowed by this section apply <em>after</em> the <span>HTML
  parser</span>'s rules have been applied. For example, a <code data-x="">&lt;a::></code> start tag
  will be closed by a <code data-x="">&lt;/a::></code> end tag, and never by a <code
  data-x="">&lt;/aU00003AU00003A></code> end tag, even if the user agent is using the rules above to
  then generate an actual element in the DOM with the name <code data-x="">aU00003AU00003A</code> for
  that start tag.</p>

  </div>


  <div w-nodev>

