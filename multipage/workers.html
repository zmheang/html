<!DOCTYPE html><html class=split lang=en-US-x-hixie><script src=/html/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport><title>HTML Standard</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/spec.css crossorigin=""><link rel=stylesheet href=https://resources.whatwg.org/standard.css crossorigin=""><link rel=stylesheet href=https://resources.whatwg.org/standard-shared-with-dev.css crossorigin=""><link rel=icon href=https://resources.whatwg.org/logo.svg crossorigin=""><link rel=stylesheet href=/html/styles.css crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><link rel=stylesheet href=/html/resources/zh-cn.css><body>
  
  <script async="" crossorigin="" src=/html/resources/html-dfn.js></script>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new async="" crossorigin="" src=https://resources.whatwg.org/file-issue.js></script>
  
  <header id=head class="head with-buttons">
   <a href=https://whatwg.org/ class=logo><img width=100 alt=WHATWG crossorigin="" src=https://resources.whatwg.org/logo.svg height=100></a>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>20 June 2021</span></h2><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/living-standard-mdash-last-updated-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/living-standard-mdash-last-updated-date-01-jan-1901.zh.html?filename=living-standard-mdash-last-updated-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fliving-standard-mdash-last-updated-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/commit-snapshot-mdash-last-updated-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/commit-snapshot-mdash-last-updated-date-01-jan-1901.zh.html?filename=commit-snapshot-mdash-last-updated-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fcommit-snapshot-mdash-last-updated-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/review-draft-mdash-published-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/review-draft-mdash-published-date-01-jan-1901.zh.html?filename=review-draft-mdash-published-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Freview-draft-mdash-published-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div></hgroup>
   
   
   <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91053840-1', 'auto');
      ga('send', 'pageview');
   </script>
  </header>

  

  


  
<div data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/table-of-contents.en.html data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/table-of-contents.zh.html></div>
  


  
<div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/full-table-of-contents.en.html data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/full-table-of-contents.zh.html></div>
  

  

  


  <nav><a href=web-messaging.html>← 9.4 跨文档通信</a> — <a href=./>Table of Contents</a> — <a href=worklets.html>11 Worklets →</a></nav><ol class=toc><li id=toc-workers><a href=workers.html#workers><span class=secno>10</span> Web 工作线程</a><ol><li><a href=workers.html#概述-7><span class=secno>10.1</span> 概述</a><ol><li><a href=workers.html#涵盖范围><span class=secno>10.1.1</span> 涵盖范围</a><li><a href=workers.html#示例-2><span class=secno>10.1.2</span> 示例</a><ol><li><a href=workers.html#数字密集型计算的后台-worker><span class=secno>10.1.2.1</span> 数字密集型计算的后台 worker</a><li><a href=workers.html#module-worker-example><span class=secno>10.1.2.2</span> 使用 JavaScript 模块作为 worker</a><li><a href=workers.html#shared-workers-introduction><span class=secno>10.1.2.3</span> 共享 worker 概述</a><li><a href=workers.html#通过共享-worker-来共享状态><span class=secno>10.1.2.4</span> 通过共享 Worker 来共享状态</a><li><a href=workers.html#委托><span class=secno>10.1.2.5</span> 委托</a><li><a href=workers.html#providing-libraries><span class=secno>10.1.2.6</span> Providing libraries</a></ol><li><a href=workers.html#教程><span class=secno>10.1.3</span> 教程</a><ol><li><a href=workers.html#创建专用工作线程><span class=secno>10.1.3.1</span> 创建专用工作线程</a><li><a href=workers.html#与专用-worker-通信><span class=secno>10.1.3.2</span> 与专用 Worker 通信</a><li><a href=workers.html#共享工作线程><span class=secno>10.1.3.3</span> 共享工作线程</a></ol></ol><li><a href=workers.html#基础设施><span class=secno>10.2</span> 基础设施</a><ol><li><a href=workers.html#全局作用域><span class=secno>10.2.1</span> 全局作用域</a><ol><li><a href=workers.html#workerglobalscope-通用接口><span class=secno>10.2.1.1</span> <code>WorkerGlobalScope</code> 通用接口</a><li><a href=workers.html#专用-worker-与-dedicatedworkerglobalscope-接口><span class=secno>10.2.1.2</span> 专用 Worker 与 <code>DedicatedWorkerGlobalScope</code> 接口</a><li><a href=workers.html#共享-worker-与-sharedworkerglobalscope-接口><span class=secno>10.2.1.3</span> 共享 worker 与 <code>SharedWorkerGlobalScope</code> 接口</a></ol><li><a href=workers.html#worker-event-loop><span class=secno>10.2.2</span> 事件循环</a><li><a href="workers.html#the-worker's-lifetime"><span class=secno>10.2.3</span> The worker's lifetime</a><li><a href=workers.html#worker-processing-model><span class=secno>10.2.4</span> Processing model</a><li><a href=workers.html#runtime-script-errors-2><span class=secno>10.2.5</span> Runtime script errors</a><li><a href=workers.html#创建-worker><span class=secno>10.2.6</span> 创建 Worker</a><ol><li><a href=workers.html#the-abstractworker-mixin><span class=secno>10.2.6.1</span> The
  <code>AbstractWorker</code> mixin</a><li><a href=workers.html#script-settings-for-workers><span class=secno>10.2.6.2</span> Script settings for workers</a><li><a href=workers.html#dedicated-workers-and-the-worker-interface><span class=secno>10.2.6.3</span> Dedicated workers and the <code>Worker</code> interface</a><li><a href=workers.html#shared-workers-and-the-sharedworker-interface><span class=secno>10.2.6.4</span> Shared workers and the <code>SharedWorker</code> interface</a></ol><li><a href=workers.html#navigator.hardwareconcurrency><span class=secno>10.2.7</span> Concurrent hardware capabilities</a></ol><li><a href=workers.html#worker-中可用的-api><span class=secno>10.3</span> Worker 中可用的 API</a><ol><li><a href=workers.html#importing-scripts-and-libraries><span class=secno>10.3.1</span> Importing scripts and libraries</a><li><a href=workers.html#the-workernavigator-object><span class=secno>10.3.2</span> The <code>WorkerNavigator</code> interface</a><li><a href=workers.html#worker-locations><span class=secno>10.3.3</span> The <code>WorkerLocation</code> interface</a></ol></ol></ol><h2 id=workers data-dfn-type=dfn data-lt="web worker"><span class=secno>10</span> Web 工作线程<a href=#workers class=self-link></a></h2><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API title="Web Workers makes it possible to run a script operation in a background thread separate from the main execution thread of a web application. The advantage of this is that laborious processing can be performed in a separate thread, allowing the main (usually the UI) thread to run without being blocked/slowed down.">Web_Workers_API</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers title="Web Workers are a simple means for web content to run scripts in background threads. The worker thread can perform tasks without interfering with the user interface. In addition, they can perform I/O using XMLHttpRequest (although the responseXML and channel attributes are always null) or fetch (with no such restrictions). Once created, a worker can send messages to the JavaScript code that created it by posting messages to an event handler specified by that code (and vice versa).">Web_Workers_API/Using_web_workers</a></div></div>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/index.en.html></div>

  <h3 id=概述-7><span class=secno>10.1</span> 概述<a href=#概述-7 class=self-link></a></h3>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/index.en.html></div>


  <h4 id=涵盖范围><span class=secno>10.1.1</span> 涵盖范围<a href=#涵盖范围 class=self-link></a></h4>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/scope.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/scope.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>本标准定义了独立于任何 UI 脚本在后台运行脚本的 API。</p>

  <p>这使得长时间运行的脚本成为可能，它们不会因响应用户点击或其他交互而中断。
  也使得耗时任务成为可能，它们不必为了保持页面可响应而立即返回。</p>

  <p>Workers （这里指这些后台脚本）相对重量级，不适合大量使用。
  例如，为400万像素图片的每一像素启动一个 Worker 就可能不太合适。
  下面的例子演示了一些合适的 workers 使用方式。</p>

  <p>通常 workers 应该有较长的生命期，较高的启动性能消耗，而且每个实例都会产生较高的内存消耗。</p>



  <h4 id=示例-2><span class=secno>10.1.2</span> 示例<a href=#示例-2 class=self-link></a></h4>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/examples/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/index.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>Worker 有着广泛的用途，下面的几节展示了其中的一些。</p>


  <h5 id=数字密集型计算的后台-worker><span class=secno>10.1.2.1</span> 数字密集型计算的后台 worker<a href=#数字密集型计算的后台-worker class=self-link></a></h5>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/examples/a-background-number-crunching-worker.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/a-background-number-crunching-worker.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>workers 最简单的使用方式是在不打断 UI 的情况下执行计算密集型的任务。</p>

  <p>本例子中，主文档启动（spawns ）了一个 worker 来（naïvely）计算质数，
  然后逐渐地显示新发现的质数。</p>

  <p>主页面如下：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Worker example: One-core computation&lt;/title>
 &lt;/head>
 &lt;body>
  &lt;p>The highest prime number discovered so far is: &lt;output id="result">&lt;/output>&lt;/p>
  &lt;script>
   var worker = new Worker('worker.js');
   worker.onmessage = function (event) {
     document.getElementById('result').textContent = event.data;
   };
  &lt;/script>
 &lt;/body>
&lt;/html>
</pre>

  <p>对 <code id=数字密集型计算的后台-worker:dom-worker><a href=#dom-worker>Worker()</a></code> 构造函数的调用创建了一个 worker，
  并返回一个表示该 worker 的 <code id=数字密集型计算的后台-worker:worker><a href=#worker>Worker</a></code> 对象，该对象用来与 worker 进行通信。
  该对象的 <code id=数字密集型计算的后台-worker:handler-worker-onmessage><a href=#handler-worker-onmessage>onmessage</a></code> 事件处理函数允许
  从 worker 接受消息。</p>

  <p>worker 本身如下：</p>

  <pre>var n = 1;
search: while (true) {
  n += 1;
  for (var i = 2; i &lt;= Math.sqrt(n); i += 1)
    if (n % i == 0)
     continue search;
  // found a prime!
  postMessage(n);
}
</pre>

  <p>这些代码就是未经优化的寻找质数算法。找到质数时使用 <code id=数字密集型计算的后台-worker:dom-dedicatedworkerglobalscope-postmessage><a href=#dom-dedicatedworkerglobalscope-postmessage>postMessage()</a></code> 方法来
  向页面发送消息。</p>

  <p><a href=/html/demos/workers/primes/page.html>在线浏览该示例</a>。</p>





  <h5 id=module-worker-example><span class=secno>10.1.2.2</span> 使用 JavaScript 模块作为 worker<a href=#module-worker-example class=self-link></a></h5>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/examples/using-a-javascript-module-as-a-worker.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/using-a-javascript-module-as-a-worker.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>目前我们所有例子的 workers 都在运行 <a href=webappapis.html#classic-script id=module-worker-example:classic-script>经典脚本
  </a>。Workers 也可以用 <a href=webappapis.html#module-script id=module-worker-example:module-script>模块脚本</a> 实例化，
  通常有如下好处：使用 JavaScript <code>import</code> 声明来引入其他模块的能力；
  默认的严格模式；顶层声明不会污染 worker 的全局作用域。</p>

  <p>注意相比于经典脚本，基于模块的 workers 遵循不同的跨域内容限制，
  不同于经典 workers，模块 workers 可以使用跨域脚本实例化，只要使用
  <a href=https://fetch.spec.whatwg.org/#http-cors-protocol id=module-worker-example:cors-protocol data-x-internal=cors-protocol>CORS 协议</a>把该脚本暴露出来。
  另外，在模块 worker 中 <code id=module-worker-example:dom-workerglobalscope-importscripts><a href=#dom-workerglobalscope-importscripts>importScripts()</a></code>
  方法将自动失效；JavaScript <code>import</code> 声明通常是更好的选择。</p>

  <p>本例子中，主文档使用了一个 worker 来做主线程外的图像操作。
  它引入了另一个模块中的过滤器。</p>

  <p>主页面如下：</p>

  <pre>&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;meta charset="utf-8">
&lt;title>Worker example: image decoding&lt;/title>

&lt;p>
  &lt;label>
    Type an image URL to decode
    &lt;input type="url" id="image-url" list="image-list">
    &lt;datalist id="image-list">
      &lt;option value="https://html.spec.whatwg.org/images/drawImage.png">
      &lt;option value="https://html.spec.whatwg.org/images/robots.jpeg">
      &lt;option value="https://html.spec.whatwg.org/images/arcTo2.png">
    &lt;/datalist>
  &lt;/label>
&lt;/p>

&lt;p>
  &lt;label>
    Choose a filter to apply
    &lt;select id="filter">
      &lt;option value="none">none&lt;/option>
      &lt;option value="grayscale">grayscale&lt;/option>
      &lt;option value="brighten">brighten by 20%&lt;/option>
    &lt;/select>
  &lt;/label>
&lt;/p>

&lt;canvas id="output">&lt;/canvas>

&lt;script type="module">
  const worker = new Worker("worker.js", { type: "module" });
  worker.onmessage = receiveFromWorker;

  const url = document.querySelector("#image-url");
  const filter = document.querySelector("#filter");
  const output = document.querySelector("#output");

  url.oninput = updateImage;
  filter.oninput = sendToWorker;

  let imageData, context;

  function updateImage() {
    const img = new Image();
    img.src = url.value;

    img.onload = () => {
      output.innerHTML = "";

      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;

      context = canvas.getContext("2d");
      context.drawImage(img, 0, 0);
      imageData = context.getImageData(0, 0, canvas.width, canvas.height);

      sendToWorker();
      output.appendChild(canvas);
    };
  }

  function sendToWorker() {
    worker.postMessage({ imageData, filter: filter.value });
  }

  function receiveFromWorker(e) {
    context.putImageData(e.data, 0, 0);
  }
&lt;/script>
</pre>

  <p>worker 文件如下：</p>

  <pre>import * as filters from "./filters.js";

self.onmessage = e => {
  const { imageData, filter } = e.data;
  filters[filter](imageData);
  self.postMessage(imageData, [imageData.data.buffer]);
};
</pre>

  <p>它引入了文件 <code>filters.js</code>：</p>

  <pre>export function none() {}

export function grayscale({ data: d }) {
  for (let i = 0; i &lt; d.length; i += 4) {
    const [r, g, b] = [d[i], d[i + 1], d[i + 2]];

    // CIE luminance for the RGB
    // The human eye is bad at seeing red and blue, so we de-emphasize them.
    d[i] = d[i + 1] = d[i + 2] = 0.2126 * r + 0.7152 * g + 0.0722 * b;
  }
};

export function brighten({ data: d }) {
  for (let i = 0; i &lt; d.length; ++i) {
    d[i] *= 1.2;
  }
};
</pre>

  <p><a href=/html/demos/workers/modules/page.html>在线浏览该示例</a>。</p>



  <h5 id=shared-workers-introduction><span class=secno>10.1.2.3</span> 共享 worker 概述<a href=#shared-workers-introduction class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker title="The SharedWorker interface represents a specific kind of worker that can be accessed from several browsing contexts, such as several windows, iframes or even workers. They implement an interface different than dedicated workers and have a different global scope, SharedWorkerGlobalScope.">SharedWorker</a><div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari no"><span>Safari</span><span>5–6.1</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>33+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>5.1–7</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>4.0–5.0</span></span><span class="opera_android no"><span>Opera Android</span><span>11–14</span></span></div></div></div>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/examples/shared-workers-introduction.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/shared-workers-introduction.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>这一节通过一个 Hello World 例子来介绍共享 Worker。由于每个 Worker 可以有多个连接，
  共享 Worker 的 API 略有不同。</p>

  <p>第一个例子展示了如何连接到 worker 以及 worker 如何向连接的页面发回消息。
  收到的消息显示在日志中。</p>

  <p>这是 HTML 页面：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
&lt;meta charset="utf-8">
&lt;title>Shared workers: demo 1&lt;/title>
&lt;pre id="log">Log:&lt;/pre>
&lt;script>
  var worker = new SharedWorker('test.js');
  var log = document.getElementById('log');
  worker.port.onmessage = function(e) { // note: not worker.onmessage!
    log.textContent += '\n' + e.data;
  }
&lt;/script>
</pre>

  <p>这是 JavaScript worker：</p>

  <pre>onconnect = function(e) {
  var port = e.ports[0];
  port.postMessage('Hello World!');
}
</pre>

  <p><a href=/html/demos/workers/shared/001/test.html>在线查看本示例</a>。</p>

  <hr>

  <p>第二个例子在两方面扩展了上一个例子：首先使用 <code>addEventListener()</code>
  来接收事件，取代了 <a href=webappapis.html#event-handler-idl-attributes id=shared-workers-introduction:event-handler-idl-attributes>事件处理函数 IDL 属性</a>。
  其次，<em>向 Worder 发送</em> 一个事件使得 Worker 以另一个事件回复。
  收到的消息仍然显示在日志中。</p>

  <p>这是 HTML 页面：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
&lt;meta charset="utf-8">
&lt;title>Shared workers: demo 2&lt;/title>
&lt;pre id="log">Log:&lt;/pre>
&lt;script>
  var worker = new SharedWorker('test.js');
  var log = document.getElementById('log');
  worker.port.addEventListener('message', function(e) {
    log.textContent += '\n' + e.data;
  }, false);
  worker.port.start(); // note: need this when using addEventListener
  worker.port.postMessage('ping');
&lt;/script>
</pre>

  <p>这是 JavaScript worker：</p>

  <pre>onconnect = function(e) {
  var port = e.ports[0];
  port.postMessage('Hello World!');
  port.onmessage = function(e) {
    port.postMessage('pong'); // not e.ports[0].postMessage!
    // e.target.postMessage('pong'); would work also
  }
}
</pre>

  <p><a href=/html/demos/workers/shared/002/test.html>在线查看本示例</a>。</p>

  <hr>

  <p>最后这个例子展示两个页面如何连接到同一个 Worker；
  这里第二个页面仅仅是第一个页面中的 <code id=shared-workers-introduction:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>，但同样的原则对
  一个 <a href=browsers.html#top-level-browsing-context id=shared-workers-introduction:top-level-browsing-context>顶级浏览环境</a> 中的完全独立的页面仍然适用。</p>

  <p>这是外部 HTML 页面：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
&lt;meta charset="utf-8">
&lt;title>Shared workers: demo 3&lt;/title>
&lt;pre id="log">Log:&lt;/pre>
&lt;script>
  var worker = new SharedWorker('test.js');
  var log = document.getElementById('log');
  worker.port.addEventListener('message', function(e) {
    log.textContent += '\n' + e.data;
  }, false);
  worker.port.start();
  worker.port.postMessage('ping');
&lt;/script>
&lt;iframe src="inner.html">&lt;/iframe>
</pre>

  <p>这是内部 HTML 页面：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
&lt;meta charset="utf-8">
&lt;title>Shared workers: demo 3 inner frame&lt;/title>
&lt;pre id=log>Inner log:&lt;/pre>
&lt;script>
  var worker = new SharedWorker('test.js');
  var log = document.getElementById('log');
  worker.port.onmessage = function(e) {
   log.textContent += '\n' + e.data;
  }
&lt;/script>
</pre>

  <p>这是 JavaScript worker：</p>

  <pre>var count = 0;
onconnect = function(e) {
  count += 1;
  var port = e.ports[0];
  port.postMessage('Hello World! You are connection #' + count);
  port.onmessage = function(e) {
    port.postMessage('pong');
  }
}
</pre>

  <p><a href=/html/demos/workers/shared/003/test.html>在线查看本示例</a>。</p>



  <h5 id=通过共享-worker-来共享状态><span class=secno>10.1.2.4</span> 通过共享 Worker 来共享状态<a href=#通过共享-worker-来共享状态 class=self-link></a></h5>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/examples/shared-state-using-a-shared-worker.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/shared-state-using-a-shared-worker.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>本例子中，可以同时打开多个窗口（查看器）来浏览同一个地图。
  在一个 Worker 的协调下，所有窗口共享同样的地图信息。
  每个查看器都可以独立地随意移动，一旦在地图上设置了任何数据，其他查看器也都会更新。</p>

  <p>主页面很普通，只是提供了打开查看器的入口：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Workers example: Multiviewer&lt;/title>
  &lt;script>
   function openViewer() {
     window.open('viewer.html');
   }
  &lt;/script>
 &lt;/head>
 &lt;body>
  &lt;p>&lt;button type=button onclick="openViewer()">Open a new
  viewer&lt;/button>&lt;/p>
  &lt;p>Each viewer opens in a new window. You can have as many viewers
  as you like, they all view the same data.&lt;/p>
 &lt;/body>
&lt;/html>
</pre>

  <p>查看器就有些意思了：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Workers example: Multiviewer viewer&lt;/title>
  &lt;script>
   var worker = new SharedWorker('worker.js', 'core');

   // CONFIGURATION
   function configure(event) {
     if (event.data.substr(0, 4) != 'cfg ') return;
     var name = event.data.substr(4).split(' ', 1)[0];
     // update display to mention our name is name
     document.getElementsByTagName('h1')[0].textContent += ' ' + name;
     // no longer need this listener
     worker.port.removeEventListener('message', configure, false);
   }
   worker.port.addEventListener('message', configure, false);

   // MAP
   function paintMap(event) {
     if (event.data.substr(0, 4) != 'map ') return;
     var data = event.data.substr(4).split(',');
     // display tiles data[0] .. data[8]
     var canvas = document.getElementById('map');
     var context = canvas.getContext('2d');
     for (var y = 0; y &lt; 3; y += 1) {
       for (var x = 0; x &lt; 3; x += 1) {
         var tile = data[y * 3 + x];
         if (tile == '0')
           context.fillStyle = 'green';
         else
           context.fillStyle = 'maroon';
         context.fillRect(x * 50, y * 50, 50, 50);
       }
     }
   }
   worker.port.addEventListener('message', paintMap, false);

   // PUBLIC CHAT
   function updatePublicChat(event) {
     if (event.data.substr(0, 4) != 'txt ') return;
     var name = event.data.substr(4).split(' ', 1)[0];
     var message = event.data.substr(4 + name.length + 1);
     // display "&lt;name> message" in public chat
     var public = document.getElementById('public');
     var p = document.createElement('p');
     var n = document.createElement('button');
     n.textContent = '&lt;' + name + '> ';
     n.onclick = function () { worker.port.postMessage('msg ' + name); };
     p.appendChild(n);
     var m = document.createElement('span');
     m.textContent = message;
     p.appendChild(m);
     public.appendChild(p);
   }
   worker.port.addEventListener('message', updatePublicChat, false);

   // PRIVATE CHAT
   function startPrivateChat(event) {
     if (event.data.substr(0, 4) != 'msg ') return;
     var name = event.data.substr(4).split(' ', 1)[0];
     var port = event.ports[0];
     // display a private chat UI
     var ul = document.getElementById('private');
     var li = document.createElement('li');
     var h3 = document.createElement('h3');
     h3.textContent = 'Private chat with ' + name;
     li.appendChild(h3);
     var div = document.createElement('div');
     var addMessage = function(name, message) {
       var p = document.createElement('p');
       var n = document.createElement('strong');
       n.textContent = '&lt;' + name + '> ';
       p.appendChild(n);
       var t = document.createElement('span');
       t.textContent = message;
       p.appendChild(t);
       div.appendChild(p);
     };
     port.onmessage = function (event) {
       addMessage(name, event.data);
     };
     li.appendChild(div);
     var form = document.createElement('form');
     var p = document.createElement('p');
     var input = document.createElement('input');
     input.size = 50;
     p.appendChild(input);
     p.appendChild(document.createTextNode(' '));
     var button = document.createElement('button');
     button.textContent = 'Post';
     p.appendChild(button);
     form.onsubmit = function () {
       port.postMessage(input.value);
       addMessage('me', input.value);
       input.value = '';
       return false;
     };
     form.appendChild(p);
     li.appendChild(form);
     ul.appendChild(li);
   }
   worker.port.addEventListener('message', startPrivateChat, false);

   worker.port.start();
  &lt;/script>
 &lt;/head>
 &lt;body>
  &lt;h1>Viewer&lt;/h1>
  &lt;h2>Map&lt;/h2>
  &lt;p>&lt;canvas id="map" height=150 width=150>&lt;/canvas>&lt;/p>
  &lt;p>
   &lt;button type=button onclick="worker.port.postMessage('mov left')">Left&lt;/button>
   &lt;button type=button onclick="worker.port.postMessage('mov up')">Up&lt;/button>
   &lt;button type=button onclick="worker.port.postMessage('mov down')">Down&lt;/button>
   &lt;button type=button onclick="worker.port.postMessage('mov right')">Right&lt;/button>
   &lt;button type=button onclick="worker.port.postMessage('set 0')">Set 0&lt;/button>
   &lt;button type=button onclick="worker.port.postMessage('set 1')">Set 1&lt;/button>
  &lt;/p>
  &lt;h2>Public Chat&lt;/h2>
  &lt;div id="public">&lt;/div>
  &lt;form onsubmit="worker.port.postMessage('txt ' + message.value); message.value = ''; return false;">
   &lt;p>
    &lt;input type="text" name="message" size="50">
    &lt;button>Post&lt;/button>
   &lt;/p>
  &lt;/form>
  &lt;h2>Private Chat&lt;/h2>
  &lt;ul id="private">&lt;/ul>
 &lt;/body>
&lt;/html>
</pre>

  <p>关于查看器的写法有几个值得一提的关键点。</p>

  <p><strong>多监听器</strong>。
  上述代码加载了多个事件监听器，每个都会检查该消息是否和它相关。
  本例子中没太大差别，但如果多个作者都希望使用同一接口与 Worker 通信，
  该设计将产生较为独立的代码，否则所有的变更都得在同一事件处理函数中进行。</p>

  <p>以这种方式注册事件处理函数也让你可以在处理完后注销特定的监听器，
  就像本例子中的 <code>configure()</code> 方法一样。</p>

  <p>这是最终的 Worker：</p>

  <pre>var nextName = 0;
function getNextName() {
  // this could use more friendly names
  // but for now just return a number
  return nextName++;
}

var map = [
 [0, 0, 0, 0, 0, 0, 0],
 [1, 1, 0, 1, 0, 1, 1],
 [0, 1, 0, 1, 0, 0, 0],
 [0, 1, 0, 1, 0, 1, 1],
 [0, 0, 0, 1, 0, 0, 0],
 [1, 0, 0, 1, 1, 1, 1],
 [1, 1, 0, 1, 1, 0, 1],
];

function wrapX(x) {
  if (x &lt; 0) return wrapX(x + map[0].length);
  if (x >= map[0].length) return wrapX(x - map[0].length);
  return x;
}

function wrapY(y) {
  if (y &lt; 0) return wrapY(y + map.length);
  if (y >= map[0].length) return wrapY(y - map.length);
  return y;
}

function wrap(val, min, max) {
  if (val &lt; min)
    return val + (max-min)+1;
  if (val > max)
    return val - (max-min)-1;
  return val;
}

function sendMapData(viewer) {
  var data = '';
  for (var y = viewer.y-1; y &lt;= viewer.y+1; y += 1) {
    for (var x = viewer.x-1; x &lt;= viewer.x+1; x += 1) {
      if (data != '')
        data += ',';
      data += map[wrap(y, 0, map[0].length-1)][wrap(x, 0, map.length-1)];
    }
  }
  viewer.port.postMessage('map ' + data);
}

var viewers = {};
onconnect = function (event) {
  var name = getNextName();
  event.ports[0]._data = { port: event.ports[0], name: name, x: 0, y: 0, };
  viewers[name] = event.ports[0]._data;
  event.ports[0].postMessage('cfg ' + name);
  event.ports[0].onmessage = getMessage;
  sendMapData(event.ports[0]._data);
};

function getMessage(event) {
  switch (event.data.substr(0, 4)) {
    case 'mov ':
      var direction = event.data.substr(4);
      var dx = 0;
      var dy = 0;
      switch (direction) {
        case 'up': dy = -1; break;
        case 'down': dy = 1; break;
        case 'left': dx = -1; break;
        case 'right': dx = 1; break;
      }
      event.target._data.x = wrapX(event.target._data.x + dx);
      event.target._data.y = wrapY(event.target._data.y + dy);
      sendMapData(event.target._data);
      break;
    case 'set ':
      var value = event.data.substr(4);
      map[event.target._data.y][event.target._data.x] = value;
      for (var viewer in viewers)
        sendMapData(viewers[viewer]);
      break;
    case 'txt ':
      var name = event.target._data.name;
      var message = event.data.substr(4);
      for (var viewer in viewers)
        viewers[viewer].port.postMessage('txt ' + name + ' ' + message);
      break;
    case 'msg ':
      var party1 = event.target._data;
      var party2 = viewers[event.data.substr(4).split(' ', 1)[0]];
      if (party2) {
        var channel = new MessageChannel();
        party1.port.postMessage('msg ' + party2.name, [channel.port1]);
        party2.port.postMessage('msg ' + party1.name, [channel.port2]);
      }
      break;
  }
}
</pre>

  <p><strong>连接到多个页面</strong>。
  脚本中使用 <code id=通过共享-worker-来共享状态:handler-sharedworkerglobalscope-onconnect><a href=#handler-sharedworkerglobalscope-onconnect>onconnect</a></code>
  时间监听器来监听多个连接。</p>

  <p><strong>直接通道</strong>。
  当 Worker 从查看器收到一条带有另一个查看器名称的"msg"消息时，
  它会在这两者之间建立一个直接的连接，使得这两个查看器可以不经由 Worker 代理而直接通信。</p>

  <p><a href=/html/demos/workers/multiviewer/page.html>在线查看该示例</a>。</p>



  <h5 id=委托><span class=secno>10.1.2.5</span> 委托<a href=#委托 class=self-link></a></h5>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/examples/delegation.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/delegation.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>随着多核 CPU 的流行，可以将计算密集型任务分割到多个 Worder 中来得到更好的性能。
  在本示例中，一个对1到10,000,000的所有数字进行操作的计算密集型的任务移交给了10个子 worker。</p>

  <p>主页面如下，它只是产出结果报告：</p>

  <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Worker example: Multicore computation&lt;/title>
 &lt;/head>
 &lt;body>
  &lt;p>Result: &lt;output id="result">&lt;/output>&lt;/p>
  &lt;script>
   var worker = new Worker('worker.js');
   worker.onmessage = function (event) {
     document.getElementById('result').textContent = event.data;
   };
  &lt;/script>
 &lt;/body>
&lt;/html>
</pre>

  <p>Worker 本身如下：</p>

  <pre>// settings
var num_workers = 10;
var items_per_worker = 1000000;

// start the workers
var result = 0;
var pending_workers = num_workers;
for (var i = 0; i &lt; num_workers; i += 1) {
  var worker = new Worker('core.js');
  worker.postMessage(i * items_per_worker);
  worker.postMessage((i+1) * items_per_worker);
  worker.onmessage = storeResult;
}

// handle the results
function storeResult(event) {
  result += 1*event.data;
  pending_workers -= 1;
  if (pending_workers &lt;= 0)
    postMessage(result); // finished!
}
</pre>

  <p>它包含了一个循环来启动子 Worker，然后定义另一个等待所有子 Worker 响应的处理函数。</p>

  <p>子 Worker 的实现如下：</p>

  <pre>var start;
onmessage = getStart;
function getStart(event) {
  start = 1*event.data;
  onmessage = getEnd;
}

var end;
function getEnd(event) {
  end = 1*event.data;
  onmessage = null;
  work();
}

function work() {
  var result = 0;
  for (var i = start; i &lt; end; i += 1) {
    // perform some complex calculation here
    result += 1;
  }
  postMessage(result);
  close();
}
</pre>

  <p>它们在两个事件中接收到两个数字，在这两个数字指定的范围上执行计算，然后向父 Worker 报告结果。</p>

  <p><a href=/html/demos/workers/multicore/page.html>在线查看该示例</a>。</p>

  <h5 id=providing-libraries><span class=secno>10.1.2.6</span> Providing libraries<a href=#providing-libraries class=self-link></a></h5>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/introduction/examples/providing-libraries.zh.html?filename=providing-libraries.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Fintroduction%2Fexamples%2Fproviding-libraries.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/examples/providing-libraries.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>Suppose that a cryptography library is made available that provides three tasks:</p>

  <dl><dt>Generate a public/private key pair<dd>Takes a port, on which it will send two messages, first the public key and then the private
   key.<dt>Given a plaintext and a public key, return the corresponding ciphertext<dd>Takes a port, to which any number of messages can be sent, the first giving the public key,
   and the remainder giving the plaintext, each of which is encrypted and then sent on that same
   channel as the ciphertext. The user can close the port when it is done encrypting content.<dt>Given a ciphertext and a private key, return the corresponding plaintext<dd>Takes a port, to which any number of messages can be sent, the first giving the private key,
   and the remainder giving the ciphertext, each of which is decrypted and then sent on that same
   channel as the plaintext. The user can close the port when it is done decrypting content.</dl>

  <p>The library itself is as follows:</p>

  <pre><code class=js>function handleMessage(e) {
  if (e.data == "genkeys")
    genkeys(e.ports[0]);
  else if (e.data == "encrypt")
    encrypt(e.ports[0]);
  else if (e.data == "decrypt")
    decrypt(e.ports[0]);
}

function genkeys(p) {
  var keys = _generateKeyPair();
  p.postMessage(keys[0]);
  p.postMessage(keys[1]);
}

function encrypt(p) {
  var key, state = 0;
  p.onmessage = function (e) {
    if (state == 0) {
      key = e.data;
      state = 1;
    } else {
      p.postMessage(_encrypt(key, e.data));
    }
  };
}

function decrypt(p) {
  var key, state = 0;
  p.onmessage = function (e) {
    if (state == 0) {
      key = e.data;
      state = 1;
    } else {
      p.postMessage(_decrypt(key, e.data));
    }
  };
}

// support being used as a shared worker as well as a dedicated worker
if ('onmessage' in this) // dedicated worker
  onmessage = handleMessage;
else // shared worker
  onconnect = function (e) { e.port.onmessage = handleMessage; }


// the "crypto" functions:

function _generateKeyPair() {
  return [Math.random(), Math.random()];
}

function _encrypt(k, s) {
  return 'encrypted-' + k + ' ' + s;
}

function _decrypt(k, s) {
  return s.substr(s.indexOf(' ')+1);
}
</code></pre>

  <p>Note that the crypto functions here are just stubs and don't do real cryptography.</p>

  <p>This library could be used as follows:</p>

  <pre><code class=html>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Worker example: Crypto library&lt;/title>
  &lt;script>
   const cryptoLib = new Worker('libcrypto-v1.js'); // or could use 'libcrypto-v2.js'
   function startConversation(source, message) {
     const messageChannel = new MessageChannel();
     source.postMessage(message, [messageChannel.port2]);
     return messageChannel.port1;
   }
   function getKeys() {
     let state = 0;
     startConversation(cryptoLib, "genkeys").onmessage = function (e) {
       if (state === 0)
         document.getElementById('public').value = e.data;
       else if (state === 1)
         document.getElementById('private').value = e.data;
       state += 1;
     };
   }
   function enc() {
     const port = startConversation(cryptoLib, "encrypt");
     port.postMessage(document.getElementById('public').value);
     port.postMessage(document.getElementById('input').value);
     port.onmessage = function (e) {
       document.getElementById('input').value = e.data;
       port.close();
     };
   }
   function dec() {
     const port = startConversation(cryptoLib, "decrypt");
     port.postMessage(document.getElementById('private').value);
     port.postMessage(document.getElementById('input').value);
     port.onmessage = function (e) {
       document.getElementById('input').value = e.data;
       port.close();
     };
   }
  &lt;/script>
  &lt;style>
   textarea { display: block; }
  &lt;/style>
 &lt;/head>
 &lt;body onload="getKeys()">
  &lt;fieldset>
   &lt;legend>Keys&lt;/legend>
   &lt;p>&lt;label>Public Key: &lt;textarea id="public">&lt;/textarea>&lt;/label>&lt;/p>
   &lt;p>&lt;label>Private Key: &lt;textarea id="private">&lt;/textarea>&lt;/label>&lt;/p>
  &lt;/fieldset>
  &lt;p>&lt;label>Input: &lt;textarea id="input">&lt;/textarea>&lt;/label>&lt;/p>
  &lt;p>&lt;button onclick="enc()">Encrypt&lt;/button> &lt;button onclick="dec()">Decrypt&lt;/button>&lt;/p>
 &lt;/body>
&lt;/html>
</code></pre>

  <p>A later version of the API, though, might want to offload all the crypto work onto subworkers.
  This could be done as follows:</p>

  <pre><code class=js>function handleMessage(e) {
  if (e.data == "genkeys")
    genkeys(e.ports[0]);
  else if (e.data == "encrypt")
    encrypt(e.ports[0]);
  else if (e.data == "decrypt")
    decrypt(e.ports[0]);
}

function genkeys(p) {
  var generator = new Worker('libcrypto-v2-generator.js');
  generator.postMessage('', [p]);
}

function encrypt(p) {
  p.onmessage = function (e) {
    var key = e.data;
    var encryptor = new Worker('libcrypto-v2-encryptor.js');
    encryptor.postMessage(key, [p]);
  };
}

function encrypt(p) {
  p.onmessage = function (e) {
    var key = e.data;
    var decryptor = new Worker('libcrypto-v2-decryptor.js');
    decryptor.postMessage(key, [p]);
  };
}

// support being used as a shared worker as well as a dedicated worker
if ('onmessage' in this) // dedicated worker
  onmessage = handleMessage;
else // shared worker
  onconnect = function (e) { e.ports[0].onmessage = handleMessage };
</code></pre>

  <p>The little subworkers would then be as follows.</p>

  <p>For generating key pairs:</p>

  <pre><code class=js>onmessage = function (e) {
  var k = _generateKeyPair();
  e.ports[0].postMessage(k[0]);
  e.ports[0].postMessage(k[1]);
  close();
}

function _generateKeyPair() {
  return [Math.random(), Math.random()];
}
</code></pre>

  <p>For encrypting:</p>

  <pre><code class=js>onmessage = function (e) {
  var key = e.data;
  e.ports[0].onmessage = function (e) {
    var s = e.data;
    postMessage(_encrypt(key, s));
  }
}

function _encrypt(k, s) {
  return 'encrypted-' + k + ' ' + s;
}
</code></pre>

  <p>For decrypting:</p>

  <pre><code class=js>onmessage = function (e) {
  var key = e.data;
  e.ports[0].onmessage = function (e) {
    var s = e.data;
    postMessage(_decrypt(key, s));
  }
}

function _decrypt(k, s) {
  return s.substr(s.indexOf(' ')+1);
}
</code></pre>

  <p>Notice how the users of the API don't have to even know that this is happening — the API
  hasn't changed; the library can delegate to subworkers without changing its API, even though it is
  accepting data using message channels.</p>

  <p><a href=/html/demos/workers/crypto/page.html>View this example online</a>.</p>



  <h4 id=教程><span class=secno>10.1.3</span> 教程<a href=#教程 class=self-link></a></h4>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/tutorials/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/tutorials/index.en.html></div>


  <h5 id=创建专用工作线程><span class=secno>10.1.3.1</span> 创建专用工作线程<a href=#创建专用工作线程 class=self-link></a></h5>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/tutorials/creating-a-dedicated-worker.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/tutorials/creating-a-dedicated-worker.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>创建专用 Worker 需要一个指向 JavaScript 文件的 URL。使用该 URL 作为唯一一个参数来调用<code id=创建专用工作线程:dom-worker><a href=#dom-worker>Worker()</a></code> 构造函数，这时会创建并返回一个 Worker：</p>

  <pre>var worker = new Worker('helper.js');</pre>

  <p>为了使你的 Worker 脚本被解析为 <a href=webappapis.html#module-script id=创建专用工作线程:module-script>模块脚本</a>
  而不是 <a href=webappapis.html#classic-script id=创建专用工作线程:classic-script>经典脚本</a>，你需要使用一个略微不同的函数签名：</p>

  <pre>var worker = new Worker('helper.js', { type: "module" });</pre>



  <h5 id=与专用-worker-通信><span class=secno>10.1.3.2</span> 与专用 Worker 通信<a href=#与专用-worker-通信 class=self-link></a></h5>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/tutorials/communicating-with-a-dedicated-worker.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/tutorials/communicating-with-a-dedicated-worker.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>专用 Worker 其实是 <code id=与专用-worker-通信:messageport><a href=web-messaging.html#messageport>MessagePort</a></code> 对象，因此支持<code id=与专用-worker-通信:messageport-2><a href=web-messaging.html#messageport>MessagePort</a></code>的所有特性。
  比如发送结构化数据、传输二进制数据、以及传输其他 Port。</p>

  <p>使用 <code id=与专用-worker-通信:worker><a href=#worker>Worker</a></code> 对象上的 <code id=与专用-worker-通信:handler-worker-onmessage><a href=#handler-worker-onmessage>onmessage</a></code>
  <a href=webappapis.html#event-handler-idl-attributes id=与专用-worker-通信:event-handler-idl-attributes>事件处理器 IDL 属性</a> 来接收专用 Worker 的消息：</p>

  <pre>worker.onmessage = function (event) { ... };</pre>

  <p>你也可以使用 <code id=与专用-worker-通信:dom-eventtarget-addeventlistener><a data-x-internal=dom-eventtarget-addeventlistener href=https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener>addEventListener()</a></code> 方法。</p>

  <p class=note>在创建专用 Worker 时，它隐式使用的 <code id=与专用-worker-通信:messageport-3><a href=web-messaging.html#messageport>MessagePort</a></code> 的 <a id=与专用-worker-通信:port-message-queue href=web-messaging.html#port-message-queue>port
  message queue</a> 会被默认开启。所以没有<code id=与专用-worker-通信:worker-2><a href=#worker>Worker</a></code> 接口上没有等价于
  <code id=与专用-worker-通信:messageport-4><a href=web-messaging.html#messageport>MessagePort</a></code> 接口的 <code id=与专用-worker-通信:dom-messageport-start><a href=web-messaging.html#dom-messageport-start>start()</a></code> 的方法。</p>

  <p>使用 <code id=与专用-worker-通信:dom-worker-postmessage><a href=#dom-worker-postmessage>postMessage()</a></code> 方法来
  <em>向 Worker 发送</em> 数据。该通信通道可以发送结构化数据，
  如果要高效地发送 <code id=与专用-worker-通信:idl-arraybuffer><a data-x-internal=idl-arraybuffer href=https://heycam.github.io/webidl/#idl-ArrayBuffer>ArrayBuffer</a></code> 对象
  （通过直接传输它们而不是克隆后发送），在第二个参数上提供它们的列表。</p>

  <pre>worker.postMessage({
  operation: 'find-edges',
  input: buffer, // an ArrayBuffer object
  threshold: 0.6,
}, [buffer]);</pre>

  <p>使用 <code id=与专用-worker-通信:handler-dedicatedworkerglobalscope-onmessage><a href=#handler-dedicatedworkerglobalscope-onmessage>onmessage</a></code>
  <a href=webappapis.html#event-handler-idl-attributes id=与专用-worker-通信:event-handler-idl-attributes-2>事件处理器 IDL 属性</a>在 Worker 中接受消息。</p>

  <pre>onmessage = function (event) { ... };</pre>

  <p>你也可以使用 <code id=与专用-worker-通信:dom-eventtarget-addeventlistener-2><a data-x-internal=dom-eventtarget-addeventlistener href=https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener>addEventListener()</a></code> 方法。</p>

  <p>上述两种方式中，数据总是在事件对象的 <code id=与专用-worker-通信:dom-messageevent-data><a href=comms.html#dom-messageevent-data>data</a></code> 属性中提供。</p>

  <p>使用 <code id=与专用-worker-通信:dom-dedicatedworkerglobalscope-postmessage><a href=#dom-dedicatedworkerglobalscope-postmessage>postMessage()</a></code>
  来回复消息，它同样支持结构化数据。</p>

  <pre>postMessage(event.data.input, [event.data.input]); // transfer the buffer back</pre>



  <h5 id=共享工作线程 data-dfn-type=dfn data-lt="shared worker"><span class=secno>10.1.3.3</span> 共享工作线程<a href=#共享工作线程 class=self-link></a></h5>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/introduction/tutorials/shared-workers.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/introduction/tutorials/shared-workers.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>共享 worker 是通过创建时的脚本 URL 来识别的。也可以显式地指定名字，
  这会使得共享 Worker 可以启动多个实例。</p>

  <p>共享 worker 作用域限制在 <a id=共享工作线程:concept-origin href=origin.html#concept-origin>origin</a> 下。使用同一 Worker 名字的两个站点不会冲突。
  然而同一站点中，尝试使用相同的 Worker 名来引用不同的脚本 URL 将会失败。</p>

  <p>使用 <code id=共享工作线程:dom-sharedworker><a href=#dom-sharedworker>SharedWorker()</a></code> 构造函数来创建共享 Worker。
  该构造函数使用脚本 URL 作为第一个参数， Worker 名（如果有的话）作为第二个参数。</p>

  <pre>var worker = new SharedWorker('service.js');</pre>

  <p>与共享 worker 通信需要显式地使用 <code id=共享工作线程:messageport><a href=web-messaging.html#messageport>MessagePort</a></code> 对象。
  <code id=共享工作线程:dom-sharedworker-2><a href=#dom-sharedworker>SharedWorker()</a></code> 构造函数返回的对象的
  <code id=共享工作线程:dom-sharedworker-port><a href=#dom-sharedworker-port>port</a></code>属性保有一个对 port 的引用。</p>

  <pre>worker.port.onmessage = function (event) { ... };
worker.port.postMessage('some message');
worker.port.postMessage({ foo: 'structured', bar: ['data', 'also', 'possible']});</pre>

  <p>在共享 worker 内，新的客户会使用 <code id=共享工作线程:event-workerglobalscope-connect><a href=indices.html#event-workerglobalscope-connect>connect</a></code> 事件
  来声明，新来的客户的 port 由事件对象的 <code id=共享工作线程:dom-messageevent-source><a href=comms.html#dom-messageevent-source>source</a></code>
  属性给出。</p>

  <pre>onconnect = function (event) {
  var newPort = event.source;
  // set up a listener
  newPort.onmessage = function (event) { ... };
  // send a message back to the port
  newPort.postMessage('ready!'); // can also send structured data, of course
};</pre>





  <h3 id=基础设施><span class=secno>10.2</span> 基础设施<a href=#基础设施 class=self-link></a></h3>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/index.en.html></div>

  <p>Worker 共有两种：专用 Worker 和共享 Worker。
  前者一经创建就会链接到其创建者，但在专用 Worker 中可以使用消息端口与其他浏览环境或 Worker 进行通信。
  然而共享 Worker 是有名字的，一经创建任何同<a href=origin.html#concept-origin id=基础设施:concept-origin>域</a>的脚本都可以获取该
  Worker 的引用并与之通信。</p>



  <h4 id=全局作用域><span class=secno>10.2.1</span> 全局作用域<a href=#全局作用域 class=self-link></a></h4>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/the-global-scope/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/the-global-scope/index.en.html></div>

  <p>全局作用域是即 worker 的内部。</p>


  <h5 id=workerglobalscope-通用接口><span class=secno>10.2.1.1</span> <code id=workerglobalscope-通用接口:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> 通用接口<a href=#workerglobalscope-通用接口 class=self-link></a></h5>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/the-global-scope/the-workerglobalscope-common-interface.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/the-global-scope/the-workerglobalscope-common-interface.en.html></div>

  <pre class=idl>[Exposed=Worker] 
interface <dfn id=workerglobalscope>WorkerGlobalScope</dfn> : <a id=workerglobalscope-通用接口:eventtarget href=https://dom.spec.whatwg.org/#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {
  readonly attribute <a href=#workerglobalscope id=workerglobalscope-通用接口:workerglobalscope-2>WorkerGlobalScope</a> <a href=#dom-workerglobalscope-self id=workerglobalscope-通用接口:dom-workerglobalscope-self>self</a>;
  readonly attribute <a href=#workerlocation id=workerglobalscope-通用接口:workerlocation>WorkerLocation</a> <a href=#dom-workerglobalscope-location id=workerglobalscope-通用接口:dom-workerglobalscope-location>location</a>;
  readonly attribute <a href=#workernavigator id=workerglobalscope-通用接口:workernavigator>WorkerNavigator</a> <a href=#dom-worker-navigator id=workerglobalscope-通用接口:dom-worker-navigator>navigator</a>;
  undefined <a href=#dom-workerglobalscope-importscripts id=workerglobalscope-通用接口:dom-workerglobalscope-importscripts>importScripts</a>(USVString... urls);

  attribute <a id=workerglobalscope-通用接口:onerroreventhandler href=webappapis.html#onerroreventhandler>OnErrorEventHandler</a> <a href=#handler-workerglobalscope-onerror id=workerglobalscope-通用接口:handler-workerglobalscope-onerror>onerror</a>;
  attribute <a id=workerglobalscope-通用接口:eventhandler href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-workerglobalscope-onlanguagechange id=workerglobalscope-通用接口:handler-workerglobalscope-onlanguagechange>onlanguagechange</a>;
  attribute <a id=workerglobalscope-通用接口:eventhandler-2 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-workerglobalscope-onoffline id=workerglobalscope-通用接口:handler-workerglobalscope-onoffline>onoffline</a>;
  attribute <a id=workerglobalscope-通用接口:eventhandler-3 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-workerglobalscope-ononline id=workerglobalscope-通用接口:handler-workerglobalscope-ononline>ononline</a>;
  attribute <a id=workerglobalscope-通用接口:eventhandler-4 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-workerglobalscope-onrejectionhandled id=workerglobalscope-通用接口:handler-workerglobalscope-onrejectionhandled>onrejectionhandled</a>;
  attribute <a id=workerglobalscope-通用接口:eventhandler-5 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-workerglobalscope-onunhandledrejection id=workerglobalscope-通用接口:handler-workerglobalscope-onunhandledrejection>onunhandledrejection</a>;
};</pre>

  <p id="the-worker's-documents"><code id=workerglobalscope-通用接口:workerglobalscope-3><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn id=concept-WorkerGlobalScope-owner-set data-for=WorkerGlobalScope data-export="">owner
  set</dfn> （<code id=workerglobalscope-通用接口:document><a href=dom.html#document>Document</a></code> 和 <code id=workerglobalscope-通用接口:workerglobalscope-4><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象的 <a href=https://infra.spec.whatwg.org/#ordered-set id=workerglobalscope-通用接口:set data-x-internal=set>集合</a>）。
  初始为空，当创建或获取 Worker 时填充。</p>

  <p class=note>拥有者不止一个，它是一个 <a href=https://infra.spec.whatwg.org/#ordered-set id=workerglobalscope-通用接口:set-2 data-x-internal=set>集合</a> 来适应
  <code id=workerglobalscope-通用接口:sharedworkerglobalscope><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 对象。</p>

  <p><code id=workerglobalscope-通用接口:workerglobalscope-5><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn id=the-workers-workers data-for=WorkerGlobalScope data-export="">worker set</dfn> （
  <code id=workerglobalscope-通用接口:workerglobalscope-6><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象的 <a href=https://infra.spec.whatwg.org/#ordered-set id=workerglobalscope-通用接口:set-3 data-x-internal=set>集合</a>）。
  它初始为空，当创建或获取其他 Worker 时填充。</p>

  <p><code id=workerglobalscope-通用接口:workerglobalscope-7><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-type data-export="">type</dfn> （"<code>classic</code>" 或 "<code>module</code>"）。在创建时设置。

  <p><code id=workerglobalscope-通用接口:workerglobalscope-8><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-url data-export="">url</dfn> （null 或一个
  <a id=workerglobalscope-通用接口:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>）。初始值为 null。

  <p><code id=workerglobalscope-通用接口:workerglobalscope-9><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-name data-export="">名称</dfn>（一个字符串）。在创建过程中设置。

  <p class=note><a href=#concept-workerglobalscope-name id=workerglobalscope-通用接口:concept-workerglobalscope-name>名称</a> 可以对每个
  <code id=workerglobalscope-通用接口:workerglobalscope-10><a href=#workerglobalscope>WorkerGlobalScope</a></code> 的子类有不同的语义。
  对于 <code id=workerglobalscope-通用接口:dedicatedworkerglobalscope><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 的实例, 它就是一个简单的开发者提供的名字，主要用于调试用途。
  对于 <code id=workerglobalscope-通用接口:sharedworkerglobalscope-2><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 的实例，它允许通过
  <code id=workerglobalscope-通用接口:dom-sharedworker><a href=#dom-sharedworker>SharedWorker()</a></code>
  构造器获得一个通用共享 Worker 的引用。
  对于 <code id=workerglobalscope-通用接口:serviceworkerglobalscope><a data-x-internal=serviceworkerglobalscope href=https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope>ServiceWorkerGlobalScope</a></code> 对象，名字没有意义（同样地，它也根本没有通过 JavaScript API 暴露出来）。</p>

  <p><code id=workerglobalscope-通用接口:workerglobalscope-11><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-referrer-policy data-export="">referrer
  策略</dfn> （一个 <a href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy id=workerglobalscope-通用接口:referrer-policy data-x-internal=referrer-policy>referrer 策略</a>）。初始值为空字符串。

  <p><code id=workerglobalscope-通用接口:workerglobalscope-12><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-embedder-policy data-export="">嵌入策略</dfn>
  （一个 <a href=origin.html#embedder-policy id=workerglobalscope-通用接口:embedder-policy>嵌入策略</a>）。</p>

  <p><code id=workerglobalscope-通用接口:workerglobalscope-13><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-csp-list data-export="">CSP 列表</dfn>。
  初始值为空列表。

  <p><code id=workerglobalscope-通用接口:workerglobalscope-14><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-module-map data-export="">模块映射</dfn>。
  初始值为空的 <a href=webappapis.html#module-map id=workerglobalscope-通用接口:module-map>模块映射</a>。</p>

  <p><code id=workerglobalscope-通用接口:workerglobalscope-15><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象有一个与之关联的 <dfn data-dfn-for=WorkerGlobalScope id=concept-workerglobalscope-cross-origin-isolated-capability data-export="">跨域隔离能力</dfn> 布尔，初始为 false。</p>

  <dl class=domintro><dt><var>workerGlobal</var> . <code id=dom-workerglobalscope-self-dev><a href=#dom-workerglobalscope-self>self</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/self title="The self read-only property of the WorkerGlobalScope interface returns a reference to the WorkerGlobalScope itself. Most of the time it is a specific scope like DedicatedWorkerGlobalScope, SharedWorkerGlobalScope, or ServiceWorkerGlobalScope.">WorkerGlobalScope/self</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>34+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><dd>返回 <var>workerGlobal</var>。<dt><var>workerGlobal</var> . <code id=dom-workerglobalscope-location-dev><a href=#dom-workerglobalscope-location>location</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/location title="The location read-only property of the WorkerGlobalScope interface returns the WorkerLocation associated with the worker. It is a specific location object, mostly a subset of the Location for browsing scopes, but adapted to workers.">WorkerGlobalScope/location</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><dd>返回 <var>workerGlobal</var> 的 <code id=workerglobalscope-通用接口:workerlocation-2><a href=#workerlocation>WorkerLocation</a></code> 对象。<dt><var>workerGlobal</var> . <code id=dom-worker-navigator-dev><a href=#dom-worker-navigator>navigator</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/navigator title="The navigator read-only property of the WorkerGlobalScope interface returns the WorkerNavigator associated with the worker. It is a specific navigator object, mostly a subset of the Navigator for browsing scopes, but adapted to workers.">WorkerGlobalScope/navigator</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>17+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><dd>返回 <var>workerGlobal</var> 的 <code id=workerglobalscope-通用接口:workernavigator-2><a href=#workernavigator>WorkerNavigator</a></code> object。<dt><var>workerGlobal</var> . <code id=dom-workerglobalscope-importscripts-dev><a href=#dom-workerglobalscope-importscripts>importScripts</a></code>(<var>urls</var>...)<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/importScripts title="The importScripts() method of the WorkerGlobalScope interface synchronously imports one or more scripts into the worker's scope.">WorkerGlobalScope/importScripts</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>4+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>3.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd>获取 <var>urls</var> 中的每一个 <a id=workerglobalscope-通用接口:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>，按照传入的顺序一个接一个地执行它们并返回
   （如果有错误则抛出异常）。</dl>

  

  <p><dfn id=dom-workerglobalscope-self><code>self</code></dfn> 属性必须返回
  <code id=workerglobalscope-通用接口:workerglobalscope-16><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象自己。</p>

  <p><dfn id=dom-workerglobalscope-location><code>location</code></dfn> 属性必须
  返回与之关联的 <a href=#concept-workerlocation-workerglobalscope id=workerglobalscope-通用接口:concept-workerlocation-workerglobalscope>
  <code>WorkerGlobalScope</code> 对象</a> 为 <code id=workerglobalscope-通用接口:workerglobalscope-17><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象的
  <code id=workerglobalscope-通用接口:workerlocation-3><a href=#workerlocation>WorkerLocation</a></code> 对象。
  </p>

  <p class=note>虽然 <code id=workerglobalscope-通用接口:workerlocation-4><a href=#workerlocation>WorkerLocation</a></code> 对象在 <code id=workerglobalscope-通用接口:workerglobalscope-18><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象之后创建，
  但是因它对脚本不可见所以不会产生问题。</p>

  

  <hr>

  <p>下面是实现 <code id=workerglobalscope-通用接口:workerglobalscope-19><a href=#workerglobalscope>WorkerGlobalScope</a></code> 接口的对象必须
  （以 <a href=webappapis.html#event-handler-idl-attributes id=workerglobalscope-通用接口:event-handler-idl-attributes>事件处理器 IDL 属性</a> 的方式）
  支持的 <a href=webappapis.html#event-handlers id=workerglobalscope-通用接口:event-handlers>事件处理器</a>
  （以及它们对应的<a href=webappapis.html#event-handler-event-type id=workerglobalscope-通用接口:event-handler-event-type>事件处理器事件类型</a>）：</p>

  <table><thead><tr><th><a href=webappapis.html#event-handlers id=workerglobalscope-通用接口:event-handlers-2>事件处理器</a> <th><a href=webappapis.html#event-handler-event-type id=workerglobalscope-通用接口:event-handler-event-type-2>事件处理器事件类型</a>
   <tbody><tr><td><dfn id=handler-workerglobalscope-onerror><code>onerror</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/onerror title="The onerror property of the WorkerGlobalScope interface represents an event handler to be called when the error event occurs and bubbles through the Worker.">WorkerGlobalScope/onerror</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td> <code id=workerglobalscope-通用接口:event-error><a href=indices.html#event-error>error</a></code>
    <tr><td><dfn id=handler-workerglobalscope-onlanguagechange><code>onlanguagechange</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/onlanguagechange title="The onlanguagechange property of the WorkerGlobalScope interface represents an event handler to be called when the languagechange event occurs and bubbles through the Worker.">WorkerGlobalScope/onlanguagechange</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>74+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td> <code id=workerglobalscope-通用接口:event-languagechange><a href=indices.html#event-languagechange>languagechange</a></code> 
    <tr><td><dfn id=handler-workerglobalscope-onoffline><code>onoffline</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/onoffline title="The onoffline property of the WorkerGlobalScope interface represents an event handler to be called when the offline event occurs and bubbles through the Worker.">WorkerGlobalScope/onoffline</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>29+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>40+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td> <code id=workerglobalscope-通用接口:event-offline><a href=indices.html#event-offline>offline</a></code> 
    <tr><td><dfn id=handler-workerglobalscope-ononline><code>ononline</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/ononline title="The ononline property of the WorkerGlobalScope interface represents an event handler to be called when the online event occurs and bubbles through the Worker.">WorkerGlobalScope/ononline</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>29+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>40+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td> <code id=workerglobalscope-通用接口:event-online><a href=indices.html#event-online>online</a></code> 
    <tr><td><dfn id=handler-workerglobalscope-onrejectionhandled><code>onrejectionhandled</code></dfn> <td> <code id=workerglobalscope-通用接口:event-rejectionhandled><a href=indices.html#event-rejectionhandled>rejectionhandled</a></code>
    <tr><td><dfn id=handler-workerglobalscope-onunhandledrejection><code>onunhandledrejection</code></dfn> <td> <code id=workerglobalscope-通用接口:event-unhandledrejection><a href=indices.html#event-unhandledrejection>unhandledrejection</a></code>
  </table>



  <h5 id=专用-worker-与-dedicatedworkerglobalscope-接口><span class=secno>10.2.1.2</span> 专用 Worker 与 <code id=dedicatedworkerglobalscope-dev><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 接口<a href=#专用-worker-与-dedicatedworkerglobalscope-接口 class=self-link></a></h5>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/the-global-scope/dedicated-workers-and-the-dedicatedworkerglobalscope-interface.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/the-global-scope/dedicated-workers-and-the-dedicatedworkerglobalscope-interface.en.html></div>

  <pre class=idl>[Global=(Worker,DedicatedWorker),Exposed=DedicatedWorker]
interface <dfn id=dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</dfn> : <a href=#workerglobalscope id=专用-worker-与-dedicatedworkerglobalscope-接口:workerglobalscope>WorkerGlobalScope</a> {
  void <a href=#dom-dedicatedworkerglobalscope-postmessage id=专用-worker-与-dedicatedworkerglobalscope-接口:dom-dedicatedworkerglobalscope-postmessage>postMessage</a>(any message, optional sequence&lt;<a href=https://heycam.github.io/webidl/#idl-object id=专用-worker-与-dedicatedworkerglobalscope-接口:idl-object data-x-internal=idl-object>object</a>> transfer = []);

  void <a href=#dom-dedicatedworkerglobalscope-close id=专用-worker-与-dedicatedworkerglobalscope-接口:dom-dedicatedworkerglobalscope-close>close</a>();

  attribute <a id=专用-worker-与-dedicatedworkerglobalscope-接口:eventhandler href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-dedicatedworkerglobalscope-onmessage id=专用-worker-与-dedicatedworkerglobalscope-接口:handler-dedicatedworkerglobalscope-onmessage>onmessage</a>;
};</pre>

  <p><code id=专用-worker-与-dedicatedworkerglobalscope-接口:dedicatedworkerglobalscope><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 对象的表现就像它有一个与之关联的隐式
  <code id=专用-worker-与-dedicatedworkerglobalscope-接口:messageport><a href=web-messaging.html#messageport>MessagePort</a></code> 一样。该端口是创建 Worker 时建立的通道的一部分，但没有暴露出来。
  禁止在<code id=专用-worker-与-dedicatedworkerglobalscope-接口:dedicatedworkerglobalscope-2><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code>之前垃圾回收该对象。</p>

  <p>该端口收到的所有消息必须立即传给 <code id=专用-worker-与-dedicatedworkerglobalscope-接口:dedicatedworkerglobalscope-3><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 对象。</p>

  <dl class=domintro><dt><var>dedicatedWorkerGlobal</var> . <code id=dom-dedicatedworkerglobalscope-postmessage-dev><a href=#dom-dedicatedworkerglobalscope-postmessage>postMessage</a></code>(<var>message</var> [,
   <var>transfer</var> ])<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/postMessage title="The postMessage() method of the DedicatedWorkerGlobalScope interface sends a message to the main thread that spawned it. This accepts a single parameter, which is the data to send from the worker to the main thread. The data may be any value or JavaScript object handled by the structured clone algorithm, which includes cyclical references.">DedicatedWorkerGlobalScope/postMessage</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd>克隆 <var>message</var> 并传送给与 <var>dedicatedWorkerGlobal</var> 关联的
   <code id=专用-worker-与-dedicatedworkerglobalscope-接口:worker><a href=#worker>Worker</a></code> 对象。<var>transfer</var> 可以传一个不需克隆而直接传输的对象列表。<dt><var>dedicatedWorkerGlobal</var> . <code id=dom-dedicatedworkerglobalscope-close-dev><a href=#dom-dedicatedworkerglobalscope-close>close</a></code>()<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/close title="The close() method of the DedicatedWorkerGlobalScope interface discards any tasks queued in the DedicatedWorkerGlobalScope's event loop, effectively closing this particular scope.">DedicatedWorkerGlobalScope/close</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div></div><dd>终止 <var>dedicatedWorkerGlobal</var>。</dl>

  

  <p>在 <code id=专用-worker-与-dedicatedworkerglobalscope-接口:dedicatedworkerglobalscope-4><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 对象上的
  <dfn id=dom-dedicatedworkerglobalscope-postmessage><code>postMessage()</code></dfn>
  方法被调用时必须表现得就像立即使用同样的参数列表调用了该端口上的
  <a href=web-messaging.html#dom-messageport-postmessage id=专用-worker-与-dedicatedworkerglobalscope-接口:dom-messageport-postmessage>同名方法</a> 一样，
  并且返回同样的返回值。</p>

  <p>给定 <var>workerGlobal</var>，<dfn id=close-a-worker data-export="">关闭 worker</dfn>
  的步骤如下：</p>

  <ol><li><p>忽略所有已添加到 <var>workerGlobal</var> 的 <a href=webappapis.html#event-loop id=专用-worker-与-dedicatedworkerglobalscope-接口:event-loop>事件循环</a> 的
   <a href=webappapis.html#task-queue id=专用-worker-与-dedicatedworkerglobalscope-接口:task-queue>任务列表</a> 中的 <a href=webappapis.html#concept-task id=专用-worker-与-dedicatedworkerglobalscope-接口:concept-task>任务</a>。</p>

   <li><p>设置 <var>workerGlobal</var> 的 <a href=#dom-workerglobalscope-closing id=专用-worker-与-dedicatedworkerglobalscope-接口:dom-workerglobalscope-closing>closing</a>
   标志为 true。（这将阻止后续的任务入队。）</ol>

  <p><dfn id=dom-dedicatedworkerglobalscope-close><code>close()</code></dfn> 方法被调用时，
  必须 <a href=#close-a-worker id=专用-worker-与-dedicatedworkerglobalscope-接口:close-a-worker>关闭</a> <code id=专用-worker-与-dedicatedworkerglobalscope-接口:dedicatedworkerglobalscope-5><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 上的 Worker。</p>

  <hr>

  

  <p>下面是实现 <code id=专用-worker-与-dedicatedworkerglobalscope-接口:dedicatedworkerglobalscope-6><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> 接口的对象必须
  （以 <a href=webappapis.html#event-handler-idl-attributes id=专用-worker-与-dedicatedworkerglobalscope-接口:event-handler-idl-attributes>事件处理器 IDL 属性</a> 的方式）
  支持的 <a href=webappapis.html#event-handlers id=专用-worker-与-dedicatedworkerglobalscope-接口:event-handlers>事件处理器</a>
  （以及它们对应的<a href=webappapis.html#event-handler-event-type id=专用-worker-与-dedicatedworkerglobalscope-接口:event-handler-event-type>事件处理器事件类型</a>）：</p>

  <table><thead><tr><th><a href=webappapis.html#event-handlers id=专用-worker-与-dedicatedworkerglobalscope-接口:event-handlers-2>事件处理器</a> <th><a href=webappapis.html#event-handler-event-type id=专用-worker-与-dedicatedworkerglobalscope-接口:event-handler-event-type-2>事件处理器事件类型</a>
   <tbody><tr><td><dfn id=handler-dedicatedworkerglobalscope-onmessage><code>onmessage</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/onmessage title="The onmessage property of the DedicatedWorkerGlobalScope interface represents an event handler to be called when the message event occurs and bubbles through the Worker — i.e. when a message is sent to the worker using the Worker.postMessage method.">DedicatedWorkerGlobalScope/onmessage</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><td> <code id=专用-worker-与-dedicatedworkerglobalscope-接口:event-message><a href=indices.html#event-message>message</a></code>
    <tr><td><dfn id=handler-dedicatedworkerglobalscope-onmessageerror><code>onmessageerror</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/onmessageerror title="The onmessageerror event handler of the DedicatedWorkerGlobalScope interface is an EventListener, called whenever an MessageEvent of type messageerror is fired on the worker—that is, when it receives a message that cannot be deserialized.">DedicatedWorkerGlobalScope/onmessageerror</a><div class=support><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera yes"><span>Opera</span><span>47+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>57+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>60+</span></span><span class="webview_android yes"><span>WebView Android</span><span>60+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>44+</span></span></div></div></div><td> <code id=专用-worker-与-dedicatedworkerglobalscope-接口:event-messageerror><a href=indices.html#event-messageerror>messageerror</a></code>
  </table>

  <p>出于 <a id=专用-worker-与-dedicatedworkerglobalscope-接口:application-cache href=offline.html#application-cache>application cache</a> 网络模型的目的，专用 worker 是
  创建它的 <a id=专用-worker-与-dedicatedworkerglobalscope-接口:cache-host href=offline.html#cache-host>cache host</a> 的一个扩展。</p>




  <h5 id=共享-worker-与-sharedworkerglobalscope-接口><span class=secno>10.2.1.3</span> 共享 worker 与 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 接口<a href=#共享-worker-与-sharedworkerglobalscope-接口 class=self-link></a></h5>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/the-global-scope/shared-workers-and-the-sharedworkerglobalscope-interface.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/the-global-scope/shared-workers-and-the-sharedworkerglobalscope-interface.en.html></div>

  <pre class=idl>[Global=(Worker,SharedWorker),Exposed=SharedWorker]
interface <dfn id=sharedworkerglobalscope>SharedWorkerGlobalScope</dfn> : <a href=#workerglobalscope id=共享-worker-与-sharedworkerglobalscope-接口:workerglobalscope>WorkerGlobalScope</a> {
  readonly attribute DOMString <a href=#dom-sharedworkerglobalscope-name id=共享-worker-与-sharedworkerglobalscope-接口:dom-sharedworkerglobalscope-name>name</a>;

  undefined <a href=#dom-sharedworkerglobalscope-close id=共享-worker-与-sharedworkerglobalscope-接口:dom-sharedworkerglobalscope-close>close</a>();

  attribute <a id=共享-worker-与-sharedworkerglobalscope-接口:eventhandler href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-sharedworkerglobalscope-onconnect id=共享-worker-与-sharedworkerglobalscope-接口:handler-sharedworkerglobalscope-onconnect>onconnect</a>;
};</pre>

  <p><code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-2><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 对象有与之相关联的
  <dfn data-dfn-for=SharedWorkerGlobalScope id=concept-sharedworkerglobalscope-constructor-origin>构造器 origin</dfn>，
  <dfn data-dfn-for=SharedWorkerGlobalScope id=concept-sharedworkerglobalscope-constructor-url>构造器 url</dfn>，以及
  <dfn data-dfn-for=SharedWorkerGlobalScope id=concept-sharedworkerglobalscope-credentials>credentials</dfn>。它们在创建
  <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-3><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 对象时初始化，是 <a href=#run-a-worker id=共享-worker-与-sharedworkerglobalscope-接口:run-a-worker>运行 Worker</a>
  算法的一部分。

  <p>共享 worker 通过它们的 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-4><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 对象上的
  <code id=共享-worker-与-sharedworkerglobalscope-接口:event-workerglobalscope-connect><a href=indices.html#event-workerglobalscope-connect>connect</a></code> 事件接受每个连接的消息端口。</p>

  <dl class=domintro><dt><var>sharedWorkerGlobal</var> . <code id=dom-sharedworkerglobalscope-name-dev><a href=#dom-sharedworkerglobalscope-name>name</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope/name title="The name read-only property of the SharedWorkerGlobalScope interface returns the name that the SharedWorker was (optionally) given when it was created. This is the name that the SharedWorker() constructor can pass to get a reference to the SharedWorkerGlobalScope.">SharedWorkerGlobalScope/name</a><div class=support><span class="firefox yes"><span>Firefox</span><span>55+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>55+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>40+</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><dd>返回 <var>sharedWorkerGlobal</var> 的 <a href=#concept-workerglobalscope-name id=共享-worker-与-sharedworkerglobalscope-接口:concept-workerglobalscope-name>name</a>，即给到 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworker><a href=#sharedworker>SharedWorker</a></code> 构造函数的值。
   通过复用同一个名字，多个 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworker-2><a href=#sharedworker>SharedWorker</a></code> 对象可以对应于同一个共享工作线程（以及 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-5><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code>）。<dt><var>sharedWorkerGlobal</var> . <code id=dom-sharedworkerglobalscope-close-dev><a href=#dom-sharedworkerglobalscope-close>close</a></code>()<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope/close title="The close() method of the SharedWorkerGlobalScope interface discards any tasks queued in the SharedWorkerGlobalScope's event loop, effectively closing this particular scope.">SharedWorkerGlobalScope/close</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>29+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>7+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd>终止 <var>sharedWorkerGlobal</var>。</dl>

  

  <p><dfn id=dom-sharedworkerglobalscope-name><code>name</code></dfn> 属性必须返回
  <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-6><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 对象的 <a href=#concept-workerglobalscope-name id=共享-worker-与-sharedworkerglobalscope-接口:concept-workerglobalscope-name-2>name</a>。使用 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworker-3><a href=#sharedworker>SharedWorker</a></code> 构造器，
  可以通过 name 的值获取该 worker 的引用。</p>

  <p><dfn id=dom-sharedworkerglobalscope-close><code>close()</code></dfn> 方法被调用时，必须
  <a href=#close-a-worker id=共享-worker-与-sharedworkerglobalscope-接口:close-a-worker>关闭</a> 该 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-7><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 对象上的 worker。</p>

  

  <hr>

  <p>下面是实现 <code id=共享-worker-与-sharedworkerglobalscope-接口:sharedworkerglobalscope-8><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> 接口的对象必须
  （以 <a href=webappapis.html#event-handler-idl-attributes id=共享-worker-与-sharedworkerglobalscope-接口:event-handler-idl-attributes>事件处理器 IDL 属性</a> 的方式）
  支持的 <a href=webappapis.html#event-handlers id=共享-worker-与-sharedworkerglobalscope-接口:event-handlers>事件处理器</a>
  （以及它们对应的<a href=webappapis.html#event-handler-event-type id=共享-worker-与-sharedworkerglobalscope-接口:event-handler-event-type>事件处理器事件类型</a>）：</p>

  <table><thead><tr><th><a href=webappapis.html#event-handlers id=共享-worker-与-sharedworkerglobalscope-接口:event-handlers-2>事件处理器</a> <th><a href=webappapis.html#event-handler-event-type id=共享-worker-与-sharedworkerglobalscope-接口:event-handler-event-type-2>事件处理器事件类型</a>
   <tbody><tr><td><dfn id=handler-sharedworkerglobalscope-onconnect><code>onconnect</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope/onconnect title="The onconnect property of the SharedWorkerGlobalScope interface is an event handler representing the code to be called when the connect event is raised — that is, when a MessagePort connection is opened between the associated SharedWorker and the main thread.">SharedWorkerGlobalScope/onconnect</a><div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>29+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td> <code id=共享-worker-与-sharedworkerglobalscope-接口:event-workerglobalscope-connect-2><a href=indices.html#event-workerglobalscope-connect>connect</a></code>
  </table>


  <h4 id=worker-event-loop><span class=secno>10.2.2</span> 事件循环<a href=#worker-event-loop class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/the-event-loop.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/the-event-loop.en.html></div>

  <p><a href=webappapis.html#worker-event-loop-2 id=worker-event-loop:worker-event-loop-2>工作线程事件循环</a> 的 <a href=webappapis.html#task-queue id=worker-event-loop:task-queue>任务队列</a>
  的 <a href=webappapis.html#concept-task id=worker-event-loop:concept-task>任务</a> 只有事件、回调和网络活动。
   这些 <a href=webappapis.html#worker-event-loop-2 id=worker-event-loop:worker-event-loop-2-2>工作线程事件循环</a> 由
  <a href=#run-a-worker id=worker-event-loop:run-a-worker>运行一个工作线程</a> 算法创建。</p>

  <p>每个 <code id=worker-event-loop:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> 对象也有一个 <dfn data-dfn-for=WorkerGlobalScope id=dom-workerglobalscope-closing data-export="">closing</dfn> 标志，初始值
  必须为 false，
  但在 
  可以 被下面的处理模型一节中的算法 设为 true。</p>

  <p>一旦 <code id=worker-event-loop:workerglobalscope-2><a href=#workerglobalscope>WorkerGlobalScope</a></code> 的 <a href=#dom-workerglobalscope-closing id=worker-event-loop:dom-workerglobalscope-closing>closing</a> 标志被设为 true，
  <a href=webappapis.html#event-loop id=worker-event-loop:event-loop>事件循环</a> 的 <a href=webappapis.html#task-queue id=worker-event-loop:task-queue-2>任务队列</a>
  必须 忽略后续添加的 <a href=webappapis.html#concept-task id=worker-event-loop:concept-task-2>任务</a>
  （已经在队列中的任务不受影响，除非另有说明）。
  也就是说一旦 <a href=#dom-workerglobalscope-closing id=worker-event-loop:dom-workerglobalscope-closing-2>closing</a> 标志位 true，
  定时器会停止触发，所有正在进行的后台操作的通知会被扔掉。</p>



  


  <h4 id="the-worker's-lifetime"><span class=secno>10.2.3</span> The worker's lifetime<a href="#the-worker's-lifetime" class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/the-workers-lifetime.zh.html?filename=the-workers-lifetime.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fthe-workers-lifetime.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/the-workers-lifetime.en.html></div>

  <p>Workers communicate with other workers and with <a href=browsers.html#browsing-context id="the-worker's-lifetime:browsing-context">browsing
  contexts</a> through <a href=web-messaging.html#通道 id="the-worker's-lifetime:通道">message channels</a> and their
  <code id="the-worker's-lifetime:messageport"><a href=web-messaging.html#messageport>MessagePort</a></code> objects.</p>

  <p>Each <code id="the-worker's-lifetime:workerglobalscope"><a href=#workerglobalscope>WorkerGlobalScope</a></code> object <var>worker global scope</var> has a list of
  <dfn id="the-worker's-ports" data-export="">the worker's ports</dfn>, which consists of all the <code id="the-worker's-lifetime:messageport-2"><a href=web-messaging.html#messageport>MessagePort</a></code> objects
  that are entangled with another port and that have one (but only one) port owned by <var>worker
  global scope</var>. This list includes the implicit <code id="the-worker's-lifetime:messageport-3"><a href=web-messaging.html#messageport>MessagePort</a></code> in the case of <a href=#dedicatedworkerglobalscope id="the-worker's-lifetime:dedicatedworkerglobalscope">dedicated workers</a>.</p>

  <p id=list-of-relevant-document-objects-to-add>Given an <a id="the-worker's-lifetime:environment-settings-object" href=webappapis.html#environment-settings-object>environment settings object</a>
  <var>o</var> when creating or obtaining a worker, the <dfn id=relevant-owner-to-add>relevant owner to add</dfn> depends on
  the type of <a href=webappapis.html#concept-settings-object-global id="the-worker's-lifetime:concept-settings-object-global">global object</a> specified by
  <var>o</var>. If <var>o</var> specifies a <a href=webappapis.html#concept-settings-object-global id="the-worker's-lifetime:concept-settings-object-global-2">global
  object</a> that is a <code id="the-worker's-lifetime:workerglobalscope-2"><a href=#workerglobalscope>WorkerGlobalScope</a></code> object (i.e., if we are creating a nested
  dedicated worker), then the relevant owner is that global object. Otherwise, <var>o</var>
  specifies a <a href=webappapis.html#concept-settings-object-global id="the-worker's-lifetime:concept-settings-object-global-3">global object</a> that is a
  <code id="the-worker's-lifetime:window"><a href=window-object.html#window>Window</a></code> object, and the relevant owner is the <a id="the-worker's-lifetime:responsible-document" href=webappapis.html#responsible-document>responsible document</a>
  specified by <var>o</var>.</p>

  <hr>

  <p>A worker is said to be a <dfn id=permissible-worker>permissible worker</dfn> if its <code id="the-worker's-lifetime:workerglobalscope-3"><a href=#workerglobalscope>WorkerGlobalScope</a></code>'s
  <a href=#concept-WorkerGlobalScope-owner-set id="the-worker's-lifetime:concept-WorkerGlobalScope-owner-set">owner set</a> is not <a href=https://infra.spec.whatwg.org/#list-is-empty id="the-worker's-lifetime:list-is-empty" data-x-internal=list-is-empty>empty</a> or:</p>

  <ul class=brief><li>its <a href=#concept-WorkerGlobalScope-owner-set id="the-worker's-lifetime:concept-WorkerGlobalScope-owner-set-2">owner set</a> has been <a href=https://infra.spec.whatwg.org/#list-is-empty id="the-worker's-lifetime:list-is-empty-2" data-x-internal=list-is-empty>empty</a> for no more
   than a short <a id="the-worker's-lifetime:implementation-defined" href=https://infra.spec.whatwg.org/#implementation-defined data-x-internal=implementation-defined>implementation-defined</a> timeout value,<li>its <code id="the-worker's-lifetime:workerglobalscope-4"><a href=#workerglobalscope>WorkerGlobalScope</a></code> object is a <code id="the-worker's-lifetime:sharedworkerglobalscope"><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object
   (i.e., the worker is a shared worker), and<li>the user agent has a <a id="the-worker's-lifetime:browsing-context-2" href=browsers.html#browsing-context>browsing context</a> whose <code id="the-worker's-lifetime:document"><a href=dom.html#document>Document</a></code> object is not
   <a id="the-worker's-lifetime:completely-loaded" href=browsing-the-web.html#completely-loaded>completely loaded</a>.</ul>

  <p class=note>The second part of this definition allows a shared worker to survive for a short
  time while a page is loading, in case that page is going to contact the shared worker again. This
  can be used by user agents as a way to avoid the cost of restarting a shared worker used by a site
  when the user is navigating from page to page within that site.</p>

  <p>A worker is said to be an <dfn id=active-needed-worker>active needed worker</dfn> if any its <a href=#concept-WorkerGlobalScope-owner-set id="the-worker's-lifetime:concept-WorkerGlobalScope-owner-set-3">owners</a> are either <code id="the-worker's-lifetime:document-2"><a href=dom.html#document>Document</a></code> objects that are <a id="the-worker's-lifetime:fully-active" href=browsers.html#fully-active>fully active</a> or
  <a href=#active-needed-worker id="the-worker's-lifetime:active-needed-worker">active needed workers</a>.</p>

  <p>A worker is said to be a <dfn id=protected-worker>protected worker</dfn> if it is an <a href=#active-needed-worker id="the-worker's-lifetime:active-needed-worker-2">active needed
  worker</a> and either it has outstanding timers, database transactions, or network connections,
  or its list of <a href="#the-worker's-ports" id="the-worker's-lifetime:the-worker's-ports">the worker's ports</a> is not empty, or its <code id="the-worker's-lifetime:workerglobalscope-5"><a href=#workerglobalscope>WorkerGlobalScope</a></code>
  is actually a <code id="the-worker's-lifetime:sharedworkerglobalscope-2"><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object (i.e., the worker is a shared
  worker).</p>

  <p>A worker is said to be a <dfn id=suspendable-worker>suspendable worker</dfn> if it is not an <a href=#active-needed-worker id="the-worker's-lifetime:active-needed-worker-3">active needed
  worker</a> but it is a <a href=#permissible-worker id="the-worker's-lifetime:permissible-worker">permissible worker</a>.</p>



  <h4 id=worker-processing-model><span class=secno>10.2.4</span> <span id=processing-model-10></span>Processing model<a href=#worker-processing-model class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/processing-model.zh.html?filename=processing-model.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fprocessing-model.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/processing-model.en.html></div>

  <p>When a user agent is to <dfn id=run-a-worker data-export="">run a worker</dfn> for a script with <code id=worker-processing-model:worker><a href=#worker>Worker</a></code> or
  <code id=worker-processing-model:sharedworker><a href=#sharedworker>SharedWorker</a></code> object <var>worker</var>, <a id=worker-processing-model:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>url</var>,
  <a id=worker-processing-model:environment-settings-object href=webappapis.html#environment-settings-object>environment settings object</a> <var>outside settings</var>, <code id=worker-processing-model:messageport><a href=web-messaging.html#messageport>MessagePort</a></code>
  <var>outside port</var>, and a <code id=worker-processing-model:workeroptions><a href=#workeroptions>WorkerOptions</a></code> dictionary <var>options</var>, it must
  run the following steps.</p>

  <ol><li><p>Let <var>is shared</var> be true if <var>worker</var> is a <code id=worker-processing-model:sharedworker-2><a href=#sharedworker>SharedWorker</a></code>
   object, and false otherwise.<li><p>Let <var>owner</var> be the <a href=#relevant-owner-to-add id=worker-processing-model:relevant-owner-to-add>relevant owner to add</a> given <var>outside
   settings</var>.<li><p>Let <var>parent worker global scope</var> be null.</p>

   <li><p>If <var>owner</var> is a <code id=worker-processing-model:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> object (i.e., we are creating a
   nested dedicated worker), then set <var>parent worker global scope</var> to
   <var>owner</var>.<li>
    <p>Let <var>agent</var> be the result of <a href=webappapis.html#obtain-a-dedicated/shared-worker-agent id=worker-processing-model:obtain-a-dedicated/shared-worker-agent>obtaining a dedicated/shared worker agent</a> given <var>outside settings</var> and
    <var>is shared</var>. Run the rest of these steps in that agent.</p>

    <p id=worker-processing-model-top>For the purposes of timing APIs, this is the <dfn id=official-moment-of-creation data-export="">official moment of creation</dfn> of the worker.</p> <li>
    <p>Let <var>realm execution context</var> be the result of <a id=worker-processing-model:creating-a-new-javascript-realm href=webappapis.html#creating-a-new-javascript-realm>creating a new JavaScript
    realm</a> given <var>agent</var> and the following customizations:</p>

    <ul><li><p>For the global object, if <var>is shared</var> is true, create a new
     <code id=worker-processing-model:sharedworkerglobalscope><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object. Otherwise, create a new
     <code id=worker-processing-model:dedicatedworkerglobalscope><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> object.</ul>
   <li>
    <p>Let <var>worker global scope</var> be the <a href=webappapis.html#concept-realm-global id=worker-processing-model:concept-realm-global>global
    object</a> of <var>realm execution context</var>'s Realm component.

    <p class=note>This is the <code id=worker-processing-model:dedicatedworkerglobalscope-2><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> or
    <code id=worker-processing-model:sharedworkerglobalscope-2><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object created in the previous step.</p>
   <li><p><a href=#set-up-a-worker-environment-settings-object id=worker-processing-model:set-up-a-worker-environment-settings-object>Set up a worker environment settings object</a> with <var>realm execution
   context</var> and <var>outside settings</var>, and let <var>inside settings</var> be the
   result.<li><p>Set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-name id=worker-processing-model:concept-workerglobalscope-name>name</a> to the value of <var>options</var>'s
   <code>name</code> member.<li><p><a href=https://infra.spec.whatwg.org/#set-append id=worker-processing-model:set-append data-x-internal=set-append>Append</a> <var>owner</var> to <var>worker global
   scope</var>'s <a href=#concept-WorkerGlobalScope-owner-set id=worker-processing-model:concept-WorkerGlobalScope-owner-set>owner set</a>.<li><p>If <var>parent worker global scope</var> is not null, then <a href=https://infra.spec.whatwg.org/#set-append id=worker-processing-model:set-append-2 data-x-internal=set-append>append</a> <var>worker global scope</var> to <var>parent worker global scope</var>'s
   <a href=#the-workers-workers id=worker-processing-model:the-workers-workers>worker set</a>.<li>
    <p>If <var>is shared</var> is true, then:</p>

    <ol><li><p>Set <var>worker global scope</var>'s <a href=#concept-sharedworkerglobalscope-constructor-origin id=worker-processing-model:concept-sharedworkerglobalscope-constructor-origin>constructor origin</a> to
     <var>outside settings</var>'s <a href=webappapis.html#concept-settings-object-origin id=worker-processing-model:concept-settings-object-origin>origin</a>.<li><p>Set <var>worker global scope</var>'s <a href=#concept-sharedworkerglobalscope-constructor-url id=worker-processing-model:concept-sharedworkerglobalscope-constructor-url>constructor url</a> to
     <var>url</var>.<li><p>Set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-type id=worker-processing-model:concept-workerglobalscope-type>type</a> to the value of <var>options</var>'s
     <code>type</code> member.<li><p>Set <var>worker global scope</var>'s <a href=#concept-sharedworkerglobalscope-credentials id=worker-processing-model:concept-sharedworkerglobalscope-credentials>credentials</a> to the value of
     <var>options</var>'s <code>credentials</code> member.
     </ol>
   <li><p>Let <var>destination</var> be "<code>sharedworker</code>" if <var>is
   shared</var> is true, and "<code>worker</code>" otherwise.<li>
    <p>Obtain <var>script</var> by switching on the value of <var>options</var>'s <code>type</code> member:</p>

    <dl class=switch><dt>"<code>classic</code>"<dd><a id=worker-processing-model:fetch-a-classic-worker-script href=webappapis.html#fetch-a-classic-worker-script>Fetch a classic worker script</a> given <var>url</var>, <var>outside
     settings</var>, <var>destination</var>, and <var>inside settings</var>.<dt>"<code>module</code>"<dd><a id=worker-processing-model:fetch-a-module-worker-script-tree href=webappapis.html#fetch-a-module-worker-script-tree>Fetch a module worker script graph</a> given <var>url</var>, <var>outside
     settings</var>, <var>destination</var>, the value of the <code>credentials</code>
     member of <var>options</var>, and <var>inside settings</var>.</dl>

    <p>In both cases, to <a href=webappapis.html#fetching-scripts-perform-fetch id=worker-processing-model:fetching-scripts-perform-fetch>perform the fetch</a>
    given <var>request</var>, perform the following steps if the <var id=worker-processing-model:fetching-scripts-is-top-level><a href=webappapis.html#fetching-scripts-is-top-level>is top-level</a></var> flag is set:</p>

    <ol><li>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reserved-client id=worker-processing-model:concept-request-reserved-client data-x-internal=concept-request-reserved-client>reserved
     client</a> to <var>inside settings</var>.<li><p><a href=https://fetch.spec.whatwg.org/#concept-fetch id=worker-processing-model:concept-fetch data-x-internal=concept-fetch>Fetch</a> <var>request</var>, and asynchronously wait
     to run the remaining steps as part of fetch's <a id=worker-processing-model:process-response href=https://fetch.spec.whatwg.org/#process-response data-x-internal=process-response>process response</a> for the <a href=https://fetch.spec.whatwg.org/#concept-response id=worker-processing-model:concept-response data-x-internal=concept-response>response</a> <var>response</var>.<li><p>Set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-url id=worker-processing-model:concept-workerglobalscope-url>url</a> to <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-url id=worker-processing-model:concept-response-url data-x-internal=concept-response-url>url</a>.<li><p>Set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-referrer-policy id=worker-processing-model:concept-workerglobalscope-referrer-policy>referrer policy</a> to the result of
     <a href=https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header id=worker-processing-model:parse-referrer-policy-header data-x-internal=parse-referrer-policy-header>parsing the `<code>Referrer-Policy</code>`
     header</a> of <var>response</var>.<li><p>If <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-url id=worker-processing-model:concept-response-url-2 data-x-internal=concept-response-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=worker-processing-model:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a> is a <a id=worker-processing-model:local-scheme href=https://fetch.spec.whatwg.org/#local-scheme data-x-internal=local-scheme>local scheme</a>, then set
     <var>worker global scope</var>'s <a href=#concept-workerglobalscope-embedder-policy id=worker-processing-model:concept-workerglobalscope-embedder-policy>embedder policy</a> to <var>owner</var>'s
     <a href=webappapis.html#concept-settings-object-embedder-policy id=worker-processing-model:concept-settings-object-embedder-policy>embedder policy</a>.<li><p>Otherwise, set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-embedder-policy id=worker-processing-model:concept-workerglobalscope-embedder-policy-2>embedder policy</a> to the result of
     <a href=origin.html#obtain-an-embedder-policy id=worker-processing-model:obtain-an-embedder-policy>obtaining an embedder policy</a> from
     <var>response</var>.<li>
      <p>If <var>worker global scope</var>'s <a href=#concept-workerglobalscope-embedder-policy id=worker-processing-model:concept-workerglobalscope-embedder-policy-3>embedder policy</a> is "<code id=worker-processing-model:coep-require-corp><a href=origin.html#coep-require-corp>require-corp</a></code>" and <var>is shared</var> is true, then set
      <var>agent</var>'s <a id=worker-processing-model:agent-cluster href=https://tc39.es/ecma262/#sec-agent-clusters data-x-internal=agent-cluster>agent cluster</a>'s <a id=worker-processing-model:cross-origin-isolated href=webappapis.html#cross-origin-isolated>cross-origin isolated</a> to
      true.</p>

      <p class=XXX>This really ought to be set when the agent cluster is created, which requires a
      redesign of this section.</p>
     <li><p>If the result of <a href="origin.html#check-a-global-object's-embedder-policy" id="worker-processing-model:check-a-global-object's-embedder-policy">checking a
     global object's embedder policy</a> with <var>worker global scope</var>, <var>owner</var>,
     and <var>response</var> is false, then set <var>response</var> to a <a id=worker-processing-model:network-error href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network
     error</a>.<li><p>Set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-cross-origin-isolated-capability id=worker-processing-model:concept-workerglobalscope-cross-origin-isolated-capability>cross-origin isolated
     capability</a> to <var>agent</var>'s <a id=worker-processing-model:agent-cluster-2 href=https://tc39.es/ecma262/#sec-agent-clusters data-x-internal=agent-cluster>agent cluster</a>'s <a id=worker-processing-model:cross-origin-isolated-2 href=webappapis.html#cross-origin-isolated>cross-origin
     isolated</a>.<li><p>If <var>is shared</var> is false and <var>owner</var>'s <a href=webappapis.html#concept-settings-object-cross-origin-isolated-capability id=worker-processing-model:concept-settings-object-cross-origin-isolated-capability>cross-origin isolated
     capability</a> is false, then set <var>worker global scope</var>'s <a href=#concept-workerglobalscope-cross-origin-isolated-capability id=worker-processing-model:concept-workerglobalscope-cross-origin-isolated-capability-2>cross-origin isolated
     capability</a> to false.<li>
      <p>If <var>is shared</var> is false and <var>response</var>'s
      <a href=https://fetch.spec.whatwg.org/#concept-response-url id=worker-processing-model:concept-response-url-3 data-x-internal=concept-response-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=worker-processing-model:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a> is "<code>data</code>", then set
      <var>worker global scope</var>'s <a href=#concept-workerglobalscope-cross-origin-isolated-capability id=worker-processing-model:concept-workerglobalscope-cross-origin-isolated-capability-3>cross-origin isolated
      capability</a> to false.</p>

      <p class=note>This is a conservative default for now, while we figure out how workers in
      general, and <code id=worker-processing-model:data-protocol><a data-x-internal=data-protocol href=https://tools.ietf.org/html/rfc2397#section-2>data:</a></code> URL workers in particular (which are
      cross-origin from their owner), will be treated in the context of permissions policies. See
      <a href=https://github.com/w3c/webappsec-permissions-policy/issues/207>w3c/webappsec-permissions-policy
      issue #207</a> for more details.</p>
     <li><p><a id="worker-processing-model:initialize-a-global-object's-csp-list" href=https://w3c.github.io/webappsec-csp/#initialize-global-object-csp data-x-internal="initialize-a-global-object's-csp-list">Initialize a global object's CSP list</a> given <var>worker global scope</var>
     and <var>response</var>. <a href=references.html#refsCSP>[CSP]</a><li><p>Asynchronously complete the <a href=webappapis.html#fetching-scripts-perform-fetch id=worker-processing-model:fetching-scripts-perform-fetch-2>perform the
     fetch</a> steps with <var>response</var>.</ol>

    <p>If the algorithm asynchronously completes with null or with a <var>script</var> whose <a href=webappapis.html#concept-script-error-to-rethrow id=worker-processing-model:concept-script-error-to-rethrow>error to rethrow</a> is non-null, then:</p>

    <ol><li><p><a id=worker-processing-model:queue-a-global-task href=webappapis.html#queue-a-global-task>Queue a global task</a> on the <a id=worker-processing-model:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a> given
     <var>worker</var>'s <a id=worker-processing-model:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global object</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=worker-processing-model:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=worker-processing-model:event-error><a href=indices.html#event-error>error</a></code>
     at <var>worker</var>.<li><p>Run the <a href=webappapis.html#environment-discarding-steps id=worker-processing-model:environment-discarding-steps>environment discarding steps</a>
     for <var>inside settings</var>.<li><p>Return.</ol>

    <p>Otherwise, continue the rest of these steps after the algorithm's asynchronous completion,
    with <var>script</var> being the asynchronous completion value.</p>
   <li><p>Associate <var>worker</var> with <var>worker global scope</var>.<li><p>Let <var>inside port</var> be a <a id=worker-processing-model:new href=https://heycam.github.io/webidl/#new data-x-internal=new>new</a> <code id=worker-processing-model:messageport-2><a href=web-messaging.html#messageport>MessagePort</a></code> object in
   <var>inside settings</var>'s <a href="webappapis.html#environment-settings-object's-realm" id="worker-processing-model:environment-settings-object's-realm">Realm</a>.<li><p>Associate <var>inside port</var> with <var>worker global scope</var>.<li><p><a id=worker-processing-model:entangle href=web-messaging.html#entangle>Entangle</a> <var>outside port</var> and <var>inside port</var>.<li><p>Create a new <code id=worker-processing-model:workerlocation><a href=#workerlocation>WorkerLocation</a></code> object and associate it with <var>worker global
   scope</var>.</p>

   <li>
    <p><strong>Closing orphan workers</strong>: Start monitoring the worker such that no sooner than
    it stops being a <a href=#protected-worker id=worker-processing-model:protected-worker>protected worker</a>, and no later than it stops being a
    <a href=#permissible-worker id=worker-processing-model:permissible-worker>permissible worker</a>, <var>worker global scope</var>'s <a href=#dom-workerglobalscope-closing id=worker-processing-model:dom-workerglobalscope-closing>closing</a> flag is set to true.</p>
   <li>
    <p><strong>Suspending workers</strong>: Start monitoring the worker, such that whenever
    <var>worker global scope</var>'s <a href=#dom-workerglobalscope-closing id=worker-processing-model:dom-workerglobalscope-closing-2>closing</a>
    flag is false and the worker is a <a href=#suspendable-worker id=worker-processing-model:suspendable-worker>suspendable worker</a>, the user agent suspends
    execution of script in that worker until such time as either the <a href=#dom-workerglobalscope-closing id=worker-processing-model:dom-workerglobalscope-closing-3>closing</a> flag switches to true or the worker stops
    being a <a href=#suspendable-worker id=worker-processing-model:suspendable-worker-2>suspendable worker</a>.</p>
   <li><p>Set <var>inside settings</var>'s <a href=webappapis.html#concept-environment-execution-ready-flag id=worker-processing-model:concept-environment-execution-ready-flag>execution ready flag</a>.<li>
    <p>If <var>script</var> is a <a id=worker-processing-model:classic-script href=webappapis.html#classic-script>classic script</a>, then <a href=webappapis.html#run-a-classic-script id=worker-processing-model:run-a-classic-script>run the classic script</a> <var>script</var>. Otherwise, it is a <a id=worker-processing-model:module-script href=webappapis.html#module-script>module
    script</a>; <a href=webappapis.html#run-a-module-script id=worker-processing-model:run-a-module-script>run the module script</a>
    <var>script</var>.</p>

    <p class=note>In addition to the usual possibilities of returning a value or failing due to
    an exception, this could be <a href=webappapis.html#abort-a-running-script id=worker-processing-model:abort-a-running-script>prematurely aborted</a> by
    the <a href=#terminate-a-worker id=worker-processing-model:terminate-a-worker>terminate a worker</a> algorithm defined below.</p>
   <li><p>Enable <var>outside port</var>'s <a id=worker-processing-model:port-message-queue href=web-messaging.html#port-message-queue>port message queue</a>.<li><p>If <var>is shared</var> is false, enable the <a id=worker-processing-model:port-message-queue-2 href=web-messaging.html#port-message-queue>port message queue</a>
   of the worker's implicit port.<li><p>If <var>is shared</var> is true, then <a id=worker-processing-model:queue-a-global-task-2 href=webappapis.html#queue-a-global-task>queue a global task</a> on <a id=worker-processing-model:dom-manipulation-task-source-2 href=webappapis.html#dom-manipulation-task-source>DOM
   manipulation task source</a> given <var>worker global scope</var> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=worker-processing-model:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=worker-processing-model:event-workerglobalscope-connect><a href=indices.html#event-workerglobalscope-connect>connect</a></code> at <var>worker global scope</var>, using
   <code id=worker-processing-model:messageevent><a href=comms.html#messageevent>MessageEvent</a></code>, with the <code id=worker-processing-model:dom-messageevent-data><a href=comms.html#dom-messageevent-data>data</a></code> attribute
   initialized to the empty string, the <code id=worker-processing-model:dom-messageevent-ports><a href=comms.html#dom-messageevent-ports>ports</a></code> attribute
   initialized to a new <a id=worker-processing-model:frozen-array href=https://heycam.github.io/webidl/#dfn-frozen-array-type data-x-internal=frozen-array>frozen array</a> containing <var>inside port</var>, and the <code id=worker-processing-model:dom-messageevent-source><a href=comms.html#dom-messageevent-source>source</a></code> attribute initialized to <var>inside
   port</var>.<li><p>Enable the <a href=https://w3c.github.io/ServiceWorker/#dfn-client-message-queue id=worker-processing-model:dfn-client-message-queue data-x-internal=dfn-client-message-queue>client message queue</a> of the
   <code id=worker-processing-model:serviceworkercontainer><a data-x-internal=serviceworkercontainer href=https://w3c.github.io/ServiceWorker/#serviceworkercontainer>ServiceWorkerContainer</a></code> object whose associated <a href=https://w3c.github.io/ServiceWorker/#serviceworkercontainer-service-worker-client id=worker-processing-model:serviceworkercontainer-service-worker-client data-x-internal=serviceworkercontainer-service-worker-client>service worker client</a> is
   <var>worker global scope</var>'s <a id=worker-processing-model:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a>.<li>
    <p><strong>Event loop</strong>: Run the <a id=worker-processing-model:responsible-event-loop href=webappapis.html#responsible-event-loop>responsible
    event loop</a> specified by <var>inside settings</var> until it is destroyed.</p>

    <p class=note>The handling of events or the execution of callbacks by <a href=webappapis.html#concept-task id=worker-processing-model:concept-task>tasks</a> run by the <a id=worker-processing-model:event-loop href=webappapis.html#event-loop>event loop</a> might get <a href=webappapis.html#abort-a-running-script id=worker-processing-model:abort-a-running-script-2>prematurely aborted</a> by the <a href=#terminate-a-worker id=worker-processing-model:terminate-a-worker-2>terminate a
    worker</a> algorithm defined below.</p>

    <p class=note>The worker processing model remains on this step until the event loop is
    destroyed, which happens after the <a href=#dom-workerglobalscope-closing id=worker-processing-model:dom-workerglobalscope-closing-4>closing</a>
    flag is set to true, as described in the <a id=worker-processing-model:event-loop-2 href=webappapis.html#event-loop>event loop</a> processing model.</p>
   <li>
    <p>Empty the <var>worker global scope</var>'s <a id=worker-processing-model:list-of-active-timers href=timers-and-user-prompts.html#list-of-active-timers>list of active timers</a>.</p>
   <li>
    <p>Disentangle all the ports in the list of <a href="#the-worker's-ports" id="worker-processing-model:the-worker's-ports">the worker's ports</a>.</p>
   <li>
     <p><a href=https://infra.spec.whatwg.org/#list-empty id=worker-processing-model:list-empty data-x-internal=list-empty>Empty</a> <var>worker global scope</var>'s <a href=#concept-WorkerGlobalScope-owner-set id=worker-processing-model:concept-WorkerGlobalScope-owner-set-2>owner set</a>.</p>
   </ol>

  <hr>

  <p>When a user agent is to <dfn id=terminate-a-worker data-export="">terminate a worker</dfn> it must run the following steps
  <a id=worker-processing-model:in-parallel href=infrastructure.html#in-parallel>in parallel</a> with the worker's main loop (the "<a href=#run-a-worker id=worker-processing-model:run-a-worker>run a worker</a>" processing
  model defined above):</p>

  <ol><li><p>Set the worker's <code id=worker-processing-model:workerglobalscope-2><a href=#workerglobalscope>WorkerGlobalScope</a></code> object's <a href=#dom-workerglobalscope-closing id=worker-processing-model:dom-workerglobalscope-closing-5>closing</a> flag to true.<li><p>If there are any <a href=webappapis.html#concept-task id=worker-processing-model:concept-task-2>tasks</a> queued in the
   <code id=worker-processing-model:workerglobalscope-3><a href=#workerglobalscope>WorkerGlobalScope</a></code> object's <a id=worker-processing-model:relevant-agent href=webappapis.html#relevant-agent>relevant agent</a>'s <a href=webappapis.html#concept-agent-event-loop id=worker-processing-model:concept-agent-event-loop>event loop</a>'s <a href=webappapis.html#task-queue id=worker-processing-model:task-queue>task
   queues</a>, discard them without processing them.<li><p><a href=webappapis.html#abort-a-running-script id=worker-processing-model:abort-a-running-script-3>Abort the script</a> currently running in the
   worker.<li><p>If the worker's <code id=worker-processing-model:workerglobalscope-4><a href=#workerglobalscope>WorkerGlobalScope</a></code> object is actually a
   <code id=worker-processing-model:dedicatedworkerglobalscope-3><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> object (i.e. the worker is a dedicated worker), then
   empty the <a id=worker-processing-model:port-message-queue-3 href=web-messaging.html#port-message-queue>port message queue</a> of the port that the worker's implicit port is
   entangled with.</ol>

  <p>User agents may invoke the <a href=#terminate-a-worker id=worker-processing-model:terminate-a-worker-3>terminate a worker</a> algorithm when a worker stops being
  an <a href=#active-needed-worker id=worker-processing-model:active-needed-worker>active needed worker</a> and the worker continues executing even after its <a href=#dom-workerglobalscope-closing id=worker-processing-model:dom-workerglobalscope-closing-6>closing</a> flag was set to true.</p>

  



  <h4 id=runtime-script-errors-2><span class=secno>10.2.5</span> Runtime script errors<a href=#runtime-script-errors-2 class=self-link></a></h4>
<div data-zh-date="" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/runtime-script-errors.zh.html?filename=runtime-script-errors.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fruntime-script-errors.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/runtime-script-errors.en.html></div>

  <p>Whenever an uncaught runtime script error occurs in one of the worker's scripts, if the error
  did not occur while handling a previous script error, the user agent must
   <a id=runtime-script-errors-2:report-the-error href=webappapis.html#report-the-error>report the error</a> for that <a href=webappapis.html#concept-script id=runtime-script-errors-2:concept-script>script</a>, with the position (line number and column number) where the
  error occurred, using the <code id=runtime-script-errors-2:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> object as the target.</p>

  <p>For shared workers, if the error is still <i id=runtime-script-errors-2:concept-error-nothandled><a href=webappapis.html#concept-error-nothandled>not handled</a></i>
  afterwards, the error may be reported to a developer console.</p>

  <p>For dedicated workers, if the error is still <i id=runtime-script-errors-2:concept-error-nothandled-2><a href=webappapis.html#concept-error-nothandled>not
  handled</a></i> afterwards, the user agent must <a id=runtime-script-errors-2:queue-a-task href=webappapis.html#queue-a-task>queue a
  task</a> to run these steps:</p>

  

  <ol><li><p>Let <var>notHandled</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=runtime-script-errors-2:concept-event-fire data-x-internal=concept-event-fire>firing an
   event</a> named <code id=runtime-script-errors-2:event-error><a href=indices.html#event-error>error</a></code> at the <code id=runtime-script-errors-2:worker><a href=#worker>Worker</a></code> object
   associated with the worker, using <code id=runtime-script-errors-2:errorevent><a href=webappapis.html#errorevent>ErrorEvent</a></code>, with the <code id=runtime-script-errors-2:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute initialized to true, the <code id=runtime-script-errors-2:dom-errorevent-message><a href=webappapis.html#dom-errorevent-message>message</a></code>, <code id=runtime-script-errors-2:dom-errorevent-filename><a href=webappapis.html#dom-errorevent-filename>filename</a></code>, <code id=runtime-script-errors-2:dom-errorevent-lineno><a href=webappapis.html#dom-errorevent-lineno>lineno</a></code>, and <code id=runtime-script-errors-2:dom-errorevent-colno><a href=webappapis.html#dom-errorevent-colno>colno</a></code> attributes initialized appropriately, and the <code id=runtime-script-errors-2:dom-errorevent-error><a href=webappapis.html#dom-errorevent-error>error</a></code> attribute initialized to null.<li><p>If <var>notHandled</var> is true, then the user agent must act as if the uncaught runtime
   script error had occurred in the global scope that the <code id=runtime-script-errors-2:worker-2><a href=#worker>Worker</a></code> object is in, thus
   repeating the entire runtime script error reporting process one level up.</ol>

  <p>If the implicit port connecting the worker to its <code id=runtime-script-errors-2:worker-3><a href=#worker>Worker</a></code> object has been
  disentangled (i.e. if the parent worker has been terminated), then the user agent must act as if
  the <code id=runtime-script-errors-2:worker-4><a href=#worker>Worker</a></code> object had no <code id=runtime-script-errors-2:event-error-2><a href=indices.html#event-error>error</a></code> event handler and as
  if that worker's <code id=runtime-script-errors-2:handler-workerglobalscope-onerror><a href=#handler-workerglobalscope-onerror>onerror</a></code> attribute was
  null, but must otherwise act as described above.</p>

  

  <p class=note>Thus, error reports propagate up to
  the chain of dedicated workers up to the original <code id=runtime-script-errors-2:document><a href=dom.html#document>Document</a></code>, even if some of the
  workers along this chain have been terminated and garbage collected.</p>

  <p>The <a id=runtime-script-errors-2:task-source href=webappapis.html#task-source>task source</a> for the task mentioned above is the <a id=runtime-script-errors-2:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation
  task source</a>.</p>



  <h4 id=创建-worker><span class=secno>10.2.6</span> 创建 Worker<a href=#创建-worker class=self-link></a></h4>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/infrastructure/creating-workers/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/creating-workers/index.en.html></div>


  <h5 id=the-abstractworker-mixin><span class=secno>10.2.6.1</span> <span id=the-abstractworker-abstract-interface></span>The
  <code id=the-abstractworker-mixin:abstractworker><a href=#abstractworker>AbstractWorker</a></code> mixin<a href=#the-abstractworker-mixin class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/AbstractWorker title="The AbstractWorker interface of the Web Workers API is an abstract interface that defines properties and methods that are common to all types of worker, including not only the basic Worker, but also ServiceWorker and SharedWorker.">AbstractWorker</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/creating-workers/the-abstractworker-mixin.zh.html?filename=the-abstractworker-mixin.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fcreating-workers%2Fthe-abstractworker-mixin.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/creating-workers/the-abstractworker-mixin.en.html></div>

  
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/creating-workers/properties-present-on-both-worker-and-sharedworker.zh.html?filename=properties-present-on-both-worker-and-sharedworker.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fcreating-workers%2Fproperties-present-on-both-worker-and-sharedworker.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/creating-workers/properties-present-on-both-worker-and-sharedworker.en.html></div>

  <pre><code class=idl>interface mixin <dfn id=abstractworker>AbstractWorker</dfn> {
  attribute <a id=the-abstractworker-mixin:eventhandler href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-abstractworker-onerror id=the-abstractworker-mixin:handler-abstractworker-onerror>onerror</a>;
};</code></pre>

  <p>The following are the <a id=the-abstractworker-mixin:event-handlers href=webappapis.html#event-handlers>event handlers</a> (and their corresponding <a href=webappapis.html#event-handler-event-type id=the-abstractworker-mixin:event-handler-event-type>event handler event types</a>) that must be supported,
  as <a id=the-abstractworker-mixin:event-handler-idl-attributes href=webappapis.html#event-handler-idl-attributes>event handler IDL attributes</a>, by objects implementing the
  <code id=the-abstractworker-mixin:abstractworker-2><a href=#abstractworker>AbstractWorker</a></code> interface:</p>

  <table><thead><tr><th><a href=webappapis.html#event-handlers id=the-abstractworker-mixin:event-handlers-2>Event handler</a> <th><a id=the-abstractworker-mixin:event-handler-event-type-2 href=webappapis.html#event-handler-event-type>Event handler event type</a>
   <tbody><tr><td><dfn id=handler-abstractworker-onerror><code>onerror</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/AbstractWorker/onerror title="The AbstractWorker.onerror property of the AbstractWorker interface represents an event handler, that is a function to be called when the error event occurs and bubbles through the Worker.">AbstractWorker/onerror</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><td> <code id=the-abstractworker-mixin:event-error><a href=indices.html#event-error>error</a></code>
  </table>


  

  <h5 id=script-settings-for-workers><span class=secno>10.2.6.2</span> Script settings for workers<a href=#script-settings-for-workers class=self-link></a></h5>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/creating-workers/script-settings-for-workers.zh.html?filename=script-settings-for-workers.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fcreating-workers%2Fscript-settings-for-workers.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/creating-workers/script-settings-for-workers.en.html></div>

  <p>To <dfn id=set-up-a-worker-environment-settings-object>set up a worker environment settings object</dfn>, given a <a id=script-settings-for-workers:javascript-execution-context href=https://tc39.es/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
  context</a> <var>execution context</var> and <a id=script-settings-for-workers:environment-settings-object href=webappapis.html#environment-settings-object>environment settings object</a>
  <var>outside settings</var>:</p>

  <ol><li><p>Let <var>inherited origin</var> be <var>outside settings</var>'s <a href=webappapis.html#concept-settings-object-origin id=script-settings-for-workers:concept-settings-object-origin>origin</a>.<li><p>Let <var>realm</var> be the value of <var>execution context</var>'s Realm
   component.<li><p>Let <var>worker global scope</var> be <var>realm</var>'s <a href=webappapis.html#concept-realm-global id=script-settings-for-workers:concept-realm-global>global object</a>.<li>
    <p>Let <var>settings object</var> be a new <a id=script-settings-for-workers:environment-settings-object-2 href=webappapis.html#environment-settings-object>environment settings object</a> whose algorithms
    are defined as follows:</p>

    <dl><dt>The <a id=script-settings-for-workers:realm-execution-context href=webappapis.html#realm-execution-context>realm execution context</a><dd>
      <p>Return <var>execution context</var>.
     <dt>The <a href=webappapis.html#concept-settings-object-module-map id=script-settings-for-workers:concept-settings-object-module-map>module map</a><dd>
      <p>Return <var>worker global scope</var>'s <a href=#concept-workerglobalscope-module-map id=script-settings-for-workers:concept-workerglobalscope-module-map>module map</a>.</p>
     <dt>The <a id=script-settings-for-workers:responsible-document href=webappapis.html#responsible-document>responsible document</a><dd><p>Not applicable (the <a id=script-settings-for-workers:responsible-event-loop href=webappapis.html#responsible-event-loop>responsible event loop</a> is not a <a id=script-settings-for-workers:window-event-loop href=webappapis.html#window-event-loop>window event
     loop</a>).<dt>The <a id=script-settings-for-workers:api-url-character-encoding href=webappapis.html#api-url-character-encoding>API URL character encoding</a><dd>
      <p>Return <a id=script-settings-for-workers:utf-8 href=https://encoding.spec.whatwg.org/#utf-8 data-x-internal=utf-8>UTF-8</a>.</p>
     <dt>The <a id=script-settings-for-workers:api-base-url href=webappapis.html#api-base-url>API base URL</a><dd>
      <p>Return <var>worker global scope</var>'s <a href=#concept-workerglobalscope-url id=script-settings-for-workers:concept-workerglobalscope-url>url</a>.</p>
     <dt>The <a href=webappapis.html#concept-settings-object-origin id=script-settings-for-workers:concept-settings-object-origin-2>origin</a><dd>
      <p>Return a unique <a href=origin.html#concept-origin-opaque id=script-settings-for-workers:concept-origin-opaque>opaque origin</a> if <var>worker
      global scope</var>'s <a href=#concept-workerglobalscope-url id=script-settings-for-workers:concept-workerglobalscope-url-2>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=script-settings-for-workers:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a> is "<code>data</code>", and <var>inherited
      origin</var> otherwise.</p>
     <dt>The <a href=webappapis.html#concept-settings-object-referrer-policy id=script-settings-for-workers:concept-settings-object-referrer-policy>referrer policy</a><dd>
      <p>Return <var>worker global scope</var>'s <a href=#concept-workerglobalscope-referrer-policy id=script-settings-for-workers:concept-workerglobalscope-referrer-policy>referrer policy</a>.</p>
     <dt>The <a href=webappapis.html#concept-settings-object-embedder-policy id=script-settings-for-workers:concept-settings-object-embedder-policy>embedder policy</a><dd>
      <p>Return <var>worker global scope</var>'s <a href=#concept-workerglobalscope-embedder-policy id=script-settings-for-workers:concept-workerglobalscope-embedder-policy>embedder policy</a>.</p>
     <dt>The <a href=webappapis.html#concept-settings-object-cross-origin-isolated-capability id=script-settings-for-workers:concept-settings-object-cross-origin-isolated-capability>cross-origin
     isolated capability</a><dd><p>Return <var>worker global scope</var>'s <a href=#concept-workerglobalscope-cross-origin-isolated-capability id=script-settings-for-workers:concept-workerglobalscope-cross-origin-isolated-capability>cross-origin isolated
     capability</a>.</dl>
   <li><p>Set <var>settings object</var>'s <a href=webappapis.html#concept-environment-id id=script-settings-for-workers:concept-environment-id>id</a> to a new
   unique opaque string, <a href=webappapis.html#concept-environment-creation-url id=script-settings-for-workers:concept-environment-creation-url>creation URL</a> to
   <var>worker global scope</var>'s <a id=script-settings-for-workers:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>url</a>, <a id=script-settings-for-workers:concept-environment-top-level-creation-url href=webappapis.html#concept-environment-top-level-creation-url>top-level creation URL</a> to null,
   <a href=webappapis.html#concept-environment-target-browsing-context id=script-settings-for-workers:concept-environment-target-browsing-context>target browsing context</a> to
   null, and <a href=webappapis.html#concept-environment-active-service-worker id=script-settings-for-workers:concept-environment-active-service-worker>active service worker</a>
   to null.<li><p>If <var>worker global scope</var> is a <code id=script-settings-for-workers:dedicatedworkerglobalscope><a href=#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> object,
   then set <var>settings object</var>'s <a id=script-settings-for-workers:concept-environment-top-level-origin href=webappapis.html#concept-environment-top-level-origin>top-level origin</a> to <var>outside
   settings</var>'s <a id=script-settings-for-workers:concept-environment-top-level-origin-2 href=webappapis.html#concept-environment-top-level-origin>top-level origin</a>.<li>
    <p>Otherwise, set <var>settings object</var>'s <a id=script-settings-for-workers:concept-environment-top-level-origin-3 href=webappapis.html#concept-environment-top-level-origin>top-level origin</a> to an
    <a id=script-settings-for-workers:implementation-defined href=https://infra.spec.whatwg.org/#implementation-defined data-x-internal=implementation-defined>implementation-defined</a> value.</p>

    <p class=XXX>See <a href=https://privacycg.github.io/storage-partitioning/>Client-Side
    Storage Partitioning</a> for the latest on properly defining this.</p>
   <li><p>Set <var>realm</var>'s [[HostDefined]] field to <var>settings object</var>.<li><p>Return <var>settings object</var>.</ol>
  



  <h5 id=dedicated-workers-and-the-worker-interface><span class=secno>10.2.6.3</span> Dedicated workers and the <code id=worker-dev><a href=#worker>Worker</a></code> interface<a href=#dedicated-workers-and-the-worker-interface class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker title="The Worker interface of the Web Workers API represents a background task that can be created via script, which can send messages back to its creator.">Worker</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/creating-workers/dedicated-workers-and-the-worker-interface.zh.html?filename=dedicated-workers-and-the-worker-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fcreating-workers%2Fdedicated-workers-and-the-worker-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/creating-workers/dedicated-workers-and-the-worker-interface.en.html></div>

  <pre><code class=idl>[Exposed=(Window,DedicatedWorker,SharedWorker)]
interface <dfn id=worker>Worker</dfn> : <a id=dedicated-workers-and-the-worker-interface:eventtarget href=https://dom.spec.whatwg.org/#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {
  <a href=#dom-worker id=dedicated-workers-and-the-worker-interface:dom-worker>constructor</a>(USVString scriptURL, optional <a href=#workeroptions id=dedicated-workers-and-the-worker-interface:workeroptions>WorkerOptions</a> options = {});

  undefined <a href=#dom-worker-terminate id=dedicated-workers-and-the-worker-interface:dom-worker-terminate>terminate</a>();

  undefined <a href=#dom-worker-postmessage id=dedicated-workers-and-the-worker-interface:dom-worker-postmessage>postMessage</a>(any message, sequence&lt;<a href=https://heycam.github.io/webidl/#idl-object id=dedicated-workers-and-the-worker-interface:idl-object data-x-internal=idl-object>object</a>> transfer);
  undefined <a href=#dom-worker-postmessage-options id=dedicated-workers-and-the-worker-interface:dom-worker-postmessage-options>postMessage</a>(any message, optional <a id=dedicated-workers-and-the-worker-interface:postmessageoptions href=web-messaging.html#postmessageoptions>PostMessageOptions</a> options = {});
  attribute <a id=dedicated-workers-and-the-worker-interface:eventhandler href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-worker-onmessage id=dedicated-workers-and-the-worker-interface:handler-worker-onmessage>onmessage</a>;
  attribute <a id=dedicated-workers-and-the-worker-interface:eventhandler-2 href=webappapis.html#eventhandler>EventHandler</a> <a href=#handler-worker-onmessageerror id=dedicated-workers-and-the-worker-interface:handler-worker-onmessageerror>onmessageerror</a>;
};

dictionary <dfn id=workeroptions>WorkerOptions</dfn> {
  <a href=#workertype id=dedicated-workers-and-the-worker-interface:workertype>WorkerType</a> type = "classic";
  <a id=dedicated-workers-and-the-worker-interface:requestcredentials href=https://fetch.spec.whatwg.org/#requestcredentials data-x-internal=requestcredentials>RequestCredentials</a> credentials = "same-origin"; // credentials is only used if type is "module"
  DOMString name = "";
};

enum <dfn id=workertype>WorkerType</dfn> { "classic", "module" };

<a href=#worker id=dedicated-workers-and-the-worker-interface:worker>Worker</a> includes <a href=#abstractworker id=dedicated-workers-and-the-worker-interface:abstractworker>AbstractWorker</a>;</code></pre>

  <dl class=domintro><dt><var>worker</var> = new <code id=dom-worker-dev><a href=#dom-worker>Worker</a></code>(<var>scriptURL</var> [, <var>options</var> ])<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker title="The Worker() constructor creates a Worker object that executes the script at the specified URL. This script must obey the same-origin policy.">Worker/Worker</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd>Returns a new <code id=dedicated-workers-and-the-worker-interface:worker-2><a href=#worker>Worker</a></code> object. <var>scriptURL</var> will be fetched and executed
   in the background, creating a new global environment for which <var>worker</var> represents the
   communication channel. <var>options</var> can be used to define the <a href=#concept-workerglobalscope-name id=dedicated-workers-and-the-worker-interface:concept-workerglobalscope-name>name</a> of that global environment via the <code>name</code> option, primarily for debugging purposes. It can also ensure this new
   global environment supports JavaScript modules (specify <code>type: "module"</code>),
   and if that is specified, can also be used to specify how <var>scriptURL</var> is fetched through
   the <code>credentials</code> option.

   <dt><var>worker</var> . <code id=dom-worker-terminate-dev><a href=#dom-worker-terminate>terminate</a></code>()<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker/terminate title="The terminate() method of the Worker interface immediately terminates the Worker. This does not offer the worker an opportunity to finish its operations; it is stopped at once.">Worker/terminate</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd>Aborts <var>worker</var>'s associated global environment.<dt><var>worker</var> . <code id=dom-worker-postmessage-dev><a href=#dom-worker-postmessage>postMessage</a></code>(<var>message</var> [, <var>transfer</var> ] )
   <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage title="The postMessage() method of the Worker interface sends a message to the worker's inner scope. This accepts a single parameter, which is the data to send to the worker. The data may be any value or JavaScript object handled by the structured clone algorithm, which includes cyclical references.">Worker/postMessage</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>47+</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>44+</span></span></div></div></div><dt><var>worker</var> . <code id=dom-worker-postmessage-options-dev><a href=#dom-worker-postmessage-options>postMessage</a></code>(<var>message</var> [, { <code id=dedicated-workers-and-the-worker-interface:dom-postmessageoptions-transfer><a href=web-messaging.html#dom-postmessageoptions-transfer>transfer</a></code> } ] )
   <dd>Clones <var>message</var> and transmits it to <var>worker</var>'s global environment.
   <var>transfer</var> can be passed as a list of objects that are to be transferred rather than
   cloned.</dl>

  

  <p>The <dfn id=dom-worker-terminate><code>terminate()</code></dfn> method, when invoked,
  must cause the <a href=#terminate-a-worker id=dedicated-workers-and-the-worker-interface:terminate-a-worker>terminate a worker</a> algorithm to be run on the worker with which the
  object is associated.</p>

  <p><code id=dedicated-workers-and-the-worker-interface:worker-3><a href=#worker>Worker</a></code> objects act as if they had an implicit <code id=dedicated-workers-and-the-worker-interface:messageport><a href=web-messaging.html#messageport>MessagePort</a></code> associated
  with them. This port is part of a channel that is set up when the worker is created, but it is not
  exposed. This object must never be garbage collected before the <code id=dedicated-workers-and-the-worker-interface:worker-4><a href=#worker>Worker</a></code> object.</p>

  <p>All messages received by that port must immediately be retargeted at the <code id=dedicated-workers-and-the-worker-interface:worker-5><a href=#worker>Worker</a></code>
  object.</p>

  <p>The <dfn id=dom-worker-postmessage><code>postMessage(<var>message</var>,
  <var>transfer</var>)</code></dfn> and <dfn id=dom-worker-postmessage-options><code>postMessage(<var>message</var>,
  <var>options</var>)</code></dfn> methods on <code id=dedicated-workers-and-the-worker-interface:worker-6><a href=#worker>Worker</a></code> objects act as if, when invoked,
  they immediately invoked the respective <code id=dedicated-workers-and-the-worker-interface:dom-messageport-postmessage><a href=web-messaging.html#dom-messageport-postmessage>postMessage(<var>message</var>, <var>transfer</var>)</a></code>
  and <code id=dedicated-workers-and-the-worker-interface:dom-messageport-postmessage-options><a href=web-messaging.html#dom-messageport-postmessage-options>postMessage(<var>message</var>,
  <var>options</var>)</a></code> on the port, with the same arguments, and returned the same return
  value.</p>

  

  <div class=example>

   <p>The <code id=dedicated-workers-and-the-worker-interface:dom-worker-postmessage-2><a href=#dom-worker-postmessage>postMessage()</a></code>
   method's first argument can be structured data:</p>

   <pre><code class=js>worker.postMessage({opcode: 'activate', device: 1938, parameters: [23, 102]});</code></pre>

  </div>

  <p>The following are the <a id=dedicated-workers-and-the-worker-interface:event-handlers href=webappapis.html#event-handlers>event handlers</a> (and their corresponding <a href=webappapis.html#event-handler-event-type id=dedicated-workers-and-the-worker-interface:event-handler-event-type>event handler event types</a>) that must be supported,
  as <a id=dedicated-workers-and-the-worker-interface:event-handler-idl-attributes href=webappapis.html#event-handler-idl-attributes>event handler IDL attributes</a>, by objects implementing the <code id=dedicated-workers-and-the-worker-interface:worker-7><a href=#worker>Worker</a></code>
  interface:</p>

  <table><thead><tr><th><a href=webappapis.html#event-handlers id=dedicated-workers-and-the-worker-interface:event-handlers-2>Event handler</a> <th><a id=dedicated-workers-and-the-worker-interface:event-handler-event-type-2 href=webappapis.html#event-handler-event-type>Event handler event type</a>
   <tbody><tr><td><dfn id=handler-worker-onmessage><code>onmessage</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker/onmessage title="The onmessage property of the Worker interface represents an event handler, that is a function to be called when the message event occurs. These events are of type MessageEvent and will be called when the worker's parent receives a message (i.e. from the DedicatedWorkerGlobalScope.postMessage method).">Worker/onmessage</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><td> <code id=dedicated-workers-and-the-worker-interface:event-message><a href=indices.html#event-message>message</a></code>
    <tr><td><dfn id=handler-worker-onmessageerror><code>onmessageerror</code></dfn> <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Worker/onmessageerror title="The onmessageerror event handler of the Worker interface is an EventListener, called whenever an MessageEvent of type messageerror is fired on the Worker instance — that is, when it receives a message that cannot be deserialized.">Worker/onmessageerror</a><div class=support><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera yes"><span>Opera</span><span>47+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>57+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>60+</span></span><span class="webview_android yes"><span>WebView Android</span><span>60+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>44+</span></span></div></div></div><td> <code id=dedicated-workers-and-the-worker-interface:event-messageerror><a href=indices.html#event-messageerror>messageerror</a></code>
  </table>

  

  <hr>

  <p>When the <dfn id=dom-worker><code>Worker(<var>scriptURL</var>,
  <var>options</var>)</code></dfn> constructor is invoked, the user agent must run the following
  steps:</p>

  <ol><li><p>The user agent may throw a <a id=dedicated-workers-and-the-worker-interface:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=dedicated-workers-and-the-worker-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> if the request violates a policy decision (e.g. if the user agent is
   configured to not allow the page to start dedicated workers).<li><p>Let <var>outside settings</var> be the <a id=dedicated-workers-and-the-worker-interface:current-settings-object href=webappapis.html#current-settings-object>current settings object</a>.</p>

   <li><p><a href=infrastructure.html#parse-a-url id=dedicated-workers-and-the-worker-interface:parse-a-url>Parse</a> the <var>scriptURL</var> argument relative to
   <var>outside settings</var>.<li><p>If this fails, throw a <a id=dedicated-workers-and-the-worker-interface:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=dedicated-workers-and-the-worker-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
    <p>Let <var>worker URL</var> be the <a id=dedicated-workers-and-the-worker-interface:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL record</a>.</p>

    <p class=note>Any <a href=origin.html#same-origin id=dedicated-workers-and-the-worker-interface:same-origin>same-origin</a> URL (including <code id=dedicated-workers-and-the-worker-interface:blob-protocol><a data-x-internal=blob-protocol href=https://w3c.github.io/FileAPI/#DefinitionOfScheme>blob:</a></code> URLs) can be used. <code id=dedicated-workers-and-the-worker-interface:data-protocol><a data-x-internal=data-protocol href=https://tools.ietf.org/html/rfc2397#section-2>data:</a></code>
    URLs can also be used, but they create a worker with an <a href=origin.html#concept-origin-opaque id=dedicated-workers-and-the-worker-interface:concept-origin-opaque>opaque origin</a>.</p>
   <li><p>Let <var>worker</var> be a new <code id=dedicated-workers-and-the-worker-interface:worker-8><a href=#worker>Worker</a></code> object.<li><p>Let <var>outside port</var> be a <a id=dedicated-workers-and-the-worker-interface:new href=https://heycam.github.io/webidl/#new data-x-internal=new>new</a> <code id=dedicated-workers-and-the-worker-interface:messageport-2><a href=web-messaging.html#messageport>MessagePort</a></code> in <var>outside
   settings</var>'s <a href="webappapis.html#environment-settings-object's-realm" id="dedicated-workers-and-the-worker-interface:environment-settings-object's-realm">Realm</a>.<li><p>Associate the <var>outside port</var> with <var>worker</var>.<li>
    <p>Run this step <a id=dedicated-workers-and-the-worker-interface:in-parallel href=infrastructure.html#in-parallel>in parallel</a>:</p>

    <ol><li><p><a href=#run-a-worker id=dedicated-workers-and-the-worker-interface:run-a-worker>Run a worker</a> given <var>worker</var>, <var>worker URL</var>, <var>outside
     settings</var>, <var>outside port</var>, and <var>options</var>.</ol>
   <li><p>Return <var>worker</var>.</ol>

  



  <h5 id=shared-workers-and-the-sharedworker-interface><span class=secno>10.2.6.4</span> Shared workers and the <code id=sharedworker-dev><a href=#sharedworker>SharedWorker</a></code> interface<a href=#shared-workers-and-the-sharedworker-interface class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker title="The SharedWorker interface represents a specific kind of worker that can be accessed from several browsing contexts, such as several windows, iframes or even workers. They implement an interface different than dedicated workers and have a different global scope, SharedWorkerGlobalScope.">SharedWorker</a><div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari no"><span>Safari</span><span>5–6.1</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>33+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>5.1–7</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>4.0–5.0</span></span><span class="opera_android no"><span>Opera Android</span><span>11–14</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/creating-workers/shared-workers-and-the-sharedworker-interface.zh.html?filename=shared-workers-and-the-sharedworker-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fcreating-workers%2Fshared-workers-and-the-sharedworker-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/creating-workers/shared-workers-and-the-sharedworker-interface.en.html></div>

  <pre><code class=idl>[Exposed=Window]
interface <dfn id=sharedworker>SharedWorker</dfn> : <a id=shared-workers-and-the-sharedworker-interface:eventtarget href=https://dom.spec.whatwg.org/#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {
  <a href=#dom-sharedworker id=shared-workers-and-the-sharedworker-interface:dom-sharedworker>constructor</a>(USVString scriptURL, optional (DOMString or <a href=#workeroptions id=shared-workers-and-the-sharedworker-interface:workeroptions>WorkerOptions</a>) options = {});

  readonly attribute <a id=shared-workers-and-the-sharedworker-interface:messageport href=web-messaging.html#messageport>MessagePort</a> <a href=#dom-sharedworker-port id=shared-workers-and-the-sharedworker-interface:dom-sharedworker-port>port</a>;
};
<a href=#sharedworker id=shared-workers-and-the-sharedworker-interface:sharedworker>SharedWorker</a> includes <a href=#abstractworker id=shared-workers-and-the-sharedworker-interface:abstractworker>AbstractWorker</a>;</code></pre>

  <dl class=domintro><dt><var>sharedWorker</var> = new <code id=dom-sharedworker-dev><a href=#dom-sharedworker>SharedWorker</a></code>(<var>scriptURL</var> [, <var>name</var> ])<div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker/SharedWorker title="The SharedWorker() constructor creates a SharedWorker object that executes the script at the specified URL. This script must obey the same-origin policy.">SharedWorker/SharedWorker</a><div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari no"><span>Safari</span><span>5–6.1</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>33+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>5.1–7</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>4.0–5.0</span></span><span class="opera_android no"><span>Opera Android</span><span>11–14</span></span></div></div></div><dd>Returns a new <code id=shared-workers-and-the-sharedworker-interface:sharedworker-2><a href=#sharedworker>SharedWorker</a></code> object. <var>scriptURL</var> will be fetched and
   executed in the background, creating a new global environment for which <var>sharedWorker</var>
   represents the communication channel. <var>name</var> can be used to define the <a href=#concept-workerglobalscope-name id=shared-workers-and-the-sharedworker-interface:concept-workerglobalscope-name>name</a> of that global environment.<dt><var>sharedWorker</var> = new <code id=shared-workers-and-the-sharedworker-interface:dom-sharedworker-2><a href=#dom-sharedworker>SharedWorker</a></code>(<var>scriptURL</var> [, <var>options</var> ])<dd>Returns a new <code id=shared-workers-and-the-sharedworker-interface:sharedworker-3><a href=#sharedworker>SharedWorker</a></code> object. <var>scriptURL</var> will be fetched and
   executed in the background, creating a new global environment for which <var>sharedWorker</var>
   represents the communication channel. <var>options</var> can be used to define the <a href=#concept-workerglobalscope-name id=shared-workers-and-the-sharedworker-interface:concept-workerglobalscope-name-2>name</a> of that global environment via the <code>name</code> option. It can also ensure this new global environment supports JavaScript
   modules (specify <code>type: "module"</code>), and if that is specified, can also be
   used to specify how <var>scriptURL</var> is fetched through the <code>credentials</code> option. Note that attempting to construct a shared worker with
   <var>options</var> whose <code>type</code> or <code>credentials</code>
   values mismatch an existing shared worker will cause the returned <var>sharedWorker</var> to
   fire an error event and not connect to the existing shared worker.<dt><var>sharedWorker</var> . <code id=dom-sharedworker-port-dev><a href=#dom-sharedworker-port>port</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker/port title="The port property of the SharedWorker interface returns a MessagePort object used to communicate and control the shared worker.">SharedWorker/port</a><div class=support><span class="firefox yes"><span>Firefox</span><span>29+</span></span><span class="safari no"><span>Safari</span><span>5–6.1</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>33+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>5.1–7</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>4.0–5.0</span></span><span class="opera_android no"><span>Opera Android</span><span>11–14</span></span></div></div></div><dd>Returns <var>sharedWorker</var>'s <code id=shared-workers-and-the-sharedworker-interface:messageport-2><a href=web-messaging.html#messageport>MessagePort</a></code> object which can be used to
   communicate with the global environment.</dl>

  

  <p>The <dfn id=dom-sharedworker-port><code>port</code></dfn> attribute must return the value
  it was assigned by the object's constructor. It represents the <code id=shared-workers-and-the-sharedworker-interface:messageport-3><a href=web-messaging.html#messageport>MessagePort</a></code> for
  communicating with the shared worker.</p>

  <p>A user agent has an associated <dfn id=shared-worker-manager>shared worker manager</dfn> which is the result of
  <a id=shared-workers-and-the-sharedworker-interface:starting-a-new-parallel-queue href=infrastructure.html#starting-a-new-parallel-queue>starting a new parallel queue</a>.</p>

  <p class=note>Each user agent has a single <a href=#shared-worker-manager id=shared-workers-and-the-sharedworker-interface:shared-worker-manager>shared worker manager</a> for simplicity.
  Implementations could use one per <a id=shared-workers-and-the-sharedworker-interface:concept-origin href=origin.html#concept-origin>origin</a>; that would not be observably different and
  enables more concurrency.</p>

  <p>When the <dfn id=dom-sharedworker><code>SharedWorker(<var>scriptURL</var>,
  <var>options</var>)</code></dfn> constructor is invoked:</p>

  <ol><li><p>Optionally, throw a <a id=shared-workers-and-the-sharedworker-interface:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=shared-workers-and-the-sharedworker-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>
   if the request violates a policy decision (e.g. if the user agent is configured to not allow the
   page to start shared workers).<li><p>If <var>options</var> is a <code id=shared-workers-and-the-sharedworker-interface:idl-domstring><a data-x-internal=idl-domstring href=https://heycam.github.io/webidl/#idl-DOMString>DOMString</a></code>, set
   <var>options</var> to a new <code id=shared-workers-and-the-sharedworker-interface:workeroptions-2><a href=#workeroptions>WorkerOptions</a></code> dictionary whose <code>name</code> member is set to the value of <var>options</var> and whose other members
   are set to their default values.<li><p>Let <var>outside settings</var> be the <a id=shared-workers-and-the-sharedworker-interface:current-settings-object href=webappapis.html#current-settings-object>current settings object</a>.<li><p><a href=infrastructure.html#parse-a-url id=shared-workers-and-the-sharedworker-interface:parse-a-url>Parse</a> <var>scriptURL</var> relative to <var>outside
   settings</var>.<li><p>If this fails, throw a <a id=shared-workers-and-the-sharedworker-interface:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=shared-workers-and-the-sharedworker-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
    <p>Otherwise, let <var>urlRecord</var> be the <a id=shared-workers-and-the-sharedworker-interface:resulting-url-record href=infrastructure.html#resulting-url-record>resulting URL record</a>.</p>

    <p class=note>Any <a href=origin.html#same-origin id=shared-workers-and-the-sharedworker-interface:same-origin>same-origin</a> URL (including <code id=shared-workers-and-the-sharedworker-interface:blob-protocol><a data-x-internal=blob-protocol href=https://w3c.github.io/FileAPI/#DefinitionOfScheme>blob:</a></code> URLs) can be used. <code id=shared-workers-and-the-sharedworker-interface:data-protocol><a data-x-internal=data-protocol href=https://tools.ietf.org/html/rfc2397#section-2>data:</a></code>
    URLs can also be used, but they create a worker with an <a href=origin.html#concept-origin-opaque id=shared-workers-and-the-sharedworker-interface:concept-origin-opaque>opaque origin</a>.</p>
   <li><p>Let <var>worker</var> be a new <code id=shared-workers-and-the-sharedworker-interface:sharedworker-4><a href=#sharedworker>SharedWorker</a></code> object.<li><p>Let <var>outside port</var> be a <a id=shared-workers-and-the-sharedworker-interface:new href=https://heycam.github.io/webidl/#new data-x-internal=new>new</a> <code id=shared-workers-and-the-sharedworker-interface:messageport-4><a href=web-messaging.html#messageport>MessagePort</a></code> in <var>outside
   settings</var>'s <a href="webappapis.html#environment-settings-object's-realm" id="shared-workers-and-the-sharedworker-interface:environment-settings-object's-realm">Realm</a>.<li><p>Assign <var>outside port</var> to the <code id=shared-workers-and-the-sharedworker-interface:dom-sharedworker-port-2><a href=#dom-sharedworker-port>port</a></code>
   attribute of <var>worker</var>.<li><p>Let <var>callerIsSecureContext</var> be true if <var>outside settings</var> is a
   <a id=shared-workers-and-the-sharedworker-interface:secure-context href=webappapis.html#secure-context>secure context</a>; otherwise, false.<li>
    <p><a id=shared-workers-and-the-sharedworker-interface:enqueue-the-following-steps href=infrastructure.html#enqueue-the-following-steps>Enqueue the following steps</a> to the <a href=#shared-worker-manager id=shared-workers-and-the-sharedworker-interface:shared-worker-manager-2>shared worker manager</a>:</p>

    <ol><li><p>Let <var>worker global scope</var> be null.<li>
      <p>If there exists a <code id=shared-workers-and-the-sharedworker-interface:sharedworkerglobalscope><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object whose <a href=#dom-workerglobalscope-closing id=shared-workers-and-the-sharedworker-interface:dom-workerglobalscope-closing>closing</a> flag is false, <a href=#concept-sharedworkerglobalscope-constructor-origin id=shared-workers-and-the-sharedworker-interface:concept-sharedworkerglobalscope-constructor-origin>constructor origin</a> is
      <a id=shared-workers-and-the-sharedworker-interface:same-origin-2 href=origin.html#same-origin>same origin</a> with <var>outside settings</var>'s <a href=webappapis.html#concept-settings-object-origin id=shared-workers-and-the-sharedworker-interface:concept-settings-object-origin>origin</a>, <a href=#concept-sharedworkerglobalscope-constructor-url id=shared-workers-and-the-sharedworker-interface:concept-sharedworkerglobalscope-constructor-url>constructor url</a> <a href=https://url.spec.whatwg.org/#concept-url-equals id=shared-workers-and-the-sharedworker-interface:concept-url-equals data-x-internal=concept-url-equals>equals</a> <var>urlRecord</var>, and <a href=#concept-workerglobalscope-name id=shared-workers-and-the-sharedworker-interface:concept-workerglobalscope-name-3>name</a> equals the value of <var>options</var>'s
      <code>name</code> member, then set <var>worker global scope</var> to that
      <code id=shared-workers-and-the-sharedworker-interface:sharedworkerglobalscope-2><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object.</p>

      <p class=note><code id=shared-workers-and-the-sharedworker-interface:data-protocol-2><a data-x-internal=data-protocol href=https://tools.ietf.org/html/rfc2397#section-2>data:</a></code> URLs create a worker with an <a href=origin.html#concept-origin-opaque id=shared-workers-and-the-sharedworker-interface:concept-origin-opaque-2>opaque origin</a>. Both the <a href=#concept-sharedworkerglobalscope-constructor-origin id=shared-workers-and-the-sharedworker-interface:concept-sharedworkerglobalscope-constructor-origin-2>constructor origin</a> and
      <a href=#concept-sharedworkerglobalscope-constructor-url id=shared-workers-and-the-sharedworker-interface:concept-sharedworkerglobalscope-constructor-url-2>constructor url</a> are
      compared so the same <code id=shared-workers-and-the-sharedworker-interface:data-protocol-3><a data-x-internal=data-protocol href=https://tools.ietf.org/html/rfc2397#section-2>data:</a></code> URL can be used within an
      <a id=shared-workers-and-the-sharedworker-interface:concept-origin-2 href=origin.html#concept-origin>origin</a> to get to the same <code id=shared-workers-and-the-sharedworker-interface:sharedworkerglobalscope-3><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object, but cannot
      be used to bypass the <a id=shared-workers-and-the-sharedworker-interface:same-origin-3 href=origin.html#same-origin>same origin</a> restriction.</p>
     <li>
      <p>If <var>worker global scope</var> is not null, but the user agent has been
      configured to disallow communication between the worker represented by the <var>worker global
      scope</var> and the <a href=webappapis.html#concept-script id=shared-workers-and-the-sharedworker-interface:concept-script>scripts</a> whose <a href=webappapis.html#settings-object id=shared-workers-and-the-sharedworker-interface:settings-object>settings object</a> is <var>outside settings</var>, then set <var>worker global
      scope</var> to null.</p>

      <p class=note>For example, a user agent could have a development mode that isolates a
      particular <a id=shared-workers-and-the-sharedworker-interface:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a> from all other pages, and scripts in that
      development mode could be blocked from connecting to shared workers running in the normal
      browser mode.</p>
     <li><p>If <var>worker global scope</var> is not null, then check if <var>worker global
     scope</var>'s <a href=#concept-workerglobalscope-type id=shared-workers-and-the-sharedworker-interface:concept-workerglobalscope-type>type</a> and <a href=#concept-sharedworkerglobalscope-credentials id=shared-workers-and-the-sharedworker-interface:concept-sharedworkerglobalscope-credentials>credentials</a> match the
     <var>options</var> values. If not, <a id=shared-workers-and-the-sharedworker-interface:queue-a-task href=webappapis.html#queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=shared-workers-and-the-sharedworker-interface:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=shared-workers-and-the-sharedworker-interface:event-error><a href=indices.html#event-error>error</a></code>
     and abort these steps.<li>
      <p>If <var>worker global scope</var> is not null, then run these subsubsteps:</p>

      <ol><li><p>Let <var>settings object</var> be the <a id=shared-workers-and-the-sharedworker-interface:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings object</a> for
       <var>worker global scope</var>.<li><p>Let <var>workerIsSecureContext</var> be true if <var>settings object</var> is a
       <a id=shared-workers-and-the-sharedworker-interface:secure-context-2 href=webappapis.html#secure-context>secure context</a>; otherwise, false.<li><p>If <var>workerIsSecureContext</var> is not <var>callerIsSecureContext</var>, then
       <a id=shared-workers-and-the-sharedworker-interface:queue-a-task-2 href=webappapis.html#queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=shared-workers-and-the-sharedworker-interface:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named
       <code id=shared-workers-and-the-sharedworker-interface:event-error-2><a href=indices.html#event-error>error</a></code> at <var>worker</var> and abort these steps.
       <a href=references.html#refsSECURE-CONTEXTS>[SECURE-CONTEXTS]</a><li><p>Associate <var>worker</var> with <var>worker global scope</var>.<li><p>Let <var>inside port</var> be a <a id=shared-workers-and-the-sharedworker-interface:new-2 href=https://heycam.github.io/webidl/#new data-x-internal=new>new</a> <code id=shared-workers-and-the-sharedworker-interface:messageport-5><a href=web-messaging.html#messageport>MessagePort</a></code> in
       <var>settings object</var>'s <a href="webappapis.html#environment-settings-object's-realm" id="shared-workers-and-the-sharedworker-interface:environment-settings-object's-realm-2">Realm</a>.<li><p><a id=shared-workers-and-the-sharedworker-interface:entangle href=web-messaging.html#entangle>Entangle</a> <var>outside port</var> and <var>inside port</var>.<li><p><a id=shared-workers-and-the-sharedworker-interface:queue-a-task-3 href=webappapis.html#queue-a-task>Queue a task</a>, using the <a id=shared-workers-and-the-sharedworker-interface:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a>, to
       <a href=https://dom.spec.whatwg.org/#concept-event-fire id=shared-workers-and-the-sharedworker-interface:concept-event-fire-3 data-x-internal=concept-event-fire>fire an event</a> named <code id=shared-workers-and-the-sharedworker-interface:event-workerglobalscope-connect><a href=indices.html#event-workerglobalscope-connect>connect</a></code> at <var>worker global scope</var>,
       using <code id=shared-workers-and-the-sharedworker-interface:messageevent><a href=comms.html#messageevent>MessageEvent</a></code>, with the <code id=shared-workers-and-the-sharedworker-interface:dom-messageevent-data><a href=comms.html#dom-messageevent-data>data</a></code>
       attribute initialized to the empty string, the <code id=shared-workers-and-the-sharedworker-interface:dom-messageevent-ports><a href=comms.html#dom-messageevent-ports>ports</a></code> attribute initialized to a new <a id=shared-workers-and-the-sharedworker-interface:frozen-array href=https://heycam.github.io/webidl/#dfn-frozen-array-type data-x-internal=frozen-array>frozen
       array</a> containing only <var>inside port</var>, and the <code id=shared-workers-and-the-sharedworker-interface:dom-messageevent-source><a href=comms.html#dom-messageevent-source>source</a></code> attribute initialized to <var>inside
       port</var>.<li><p><a href=https://infra.spec.whatwg.org/#set-append id=shared-workers-and-the-sharedworker-interface:set-append data-x-internal=set-append>Append</a> the <a href=#relevant-owner-to-add id=shared-workers-and-the-sharedworker-interface:relevant-owner-to-add>relevant owner to add</a> given
       <var>outside settings</var> to <var>worker global scope</var>'s <a href=#concept-WorkerGlobalScope-owner-set id=shared-workers-and-the-sharedworker-interface:concept-WorkerGlobalScope-owner-set>owner
       set</a>.</ol>
     <li><p>Otherwise, <a id=shared-workers-and-the-sharedworker-interface:in-parallel href=infrastructure.html#in-parallel>in parallel</a>, <a href=#run-a-worker id=shared-workers-and-the-sharedworker-interface:run-a-worker>run a worker</a> given <var>worker</var>,
     <var>urlRecord</var>, <var>outside settings</var>, <var>outside port</var>, and
     <var>options</var>.</ol>
   <li><p>Return <var>worker</var>.</ol>

  



  <h4 id=navigator.hardwareconcurrency><span class=secno>10.2.7</span> Concurrent hardware capabilities<a href=#navigator.hardwareconcurrency class=self-link></a></h4><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/NavigatorConcurrentHardware title="The NavigatorConcurrentHardware mixin adds to the Navigator interface features which allow Web content to determine how many logical processors the user has available, in order to let content and Web apps optimize their operations to best take advantage of the user's CPU.">NavigatorConcurrentHardware</a><div class=support><span class="firefox yes"><span>Firefox</span><span>48+</span></span><span class="safari no"><span>Safari</span><span>10.1–11</span></span><span class="chrome yes"><span>Chrome</span><span>37+</span></span><hr><span class="opera yes"><span>Opera</span><span>24+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>15+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>48+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>10.3–11</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>37+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>3.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>24+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/infrastructure/concurrent-hardware-capabilities.zh.html?filename=concurrent-hardware-capabilities.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Finfrastructure%2Fconcurrent-hardware-capabilities.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/infrastructure/concurrent-hardware-capabilities.en.html></div>

  <pre><code class=idl>interface mixin <dfn id=navigatorconcurrenthardware>NavigatorConcurrentHardware</dfn> {
  readonly attribute unsigned long long <a href=#dom-navigator-hardwareconcurrency id=navigator.hardwareconcurrency:dom-navigator-hardwareconcurrency>hardwareConcurrency</a>;
};</code></pre>

  <dl class=domintro><dt><var>self</var> . <code id=navigator.hardwareconcurrency:dom-navigator><a href=system-state.html#dom-navigator>navigator</a></code> . <code id=dom-navigator-hardwareconcurrency-dev><a href=#dom-navigator-hardwareconcurrency>hardwareConcurrency</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/NavigatorConcurrentHardware/hardwareConcurrency title="The navigator.hardwareConcurrency read-only property returns the number of logical processors available to run threads on the user's computer.">NavigatorConcurrentHardware/hardwareConcurrency</a><div class=support><span class="firefox yes"><span>Firefox</span><span>48+</span></span><span class="safari no"><span>Safari</span><span>10.1–11</span></span><span class="chrome yes"><span>Chrome</span><span>37+</span></span><hr><span class="opera yes"><span>Opera</span><span>24+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>15+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>48+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>10.3–11</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>37+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>3.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>24+</span></span></div></div></div><dd><p>Returns the number of logical processors potentially available to the user agent.</dl>

  

  <p>
  <a id=navigator.hardwareconcurrency:tracking-vector title="There is a tracking vector here." href=https://infra.spec.whatwg.org/#tracking-vector class=tracking-vector data-x-internal=tracking-vector><img width=46 alt="(This is a tracking vector.)" crossorigin="" src=https://resources.whatwg.org/tracking-vector.svg height=64></a>
  The <dfn id=dom-navigator-hardwareconcurrency><code>navigator.hardwareConcurrency</code></dfn> attribute's
  getter must return a number between 1 and the number of logical processors potentially available
  to the user agent. If this cannot be determined, the getter must return 1.</p>

  <p>User agents should err toward exposing the number of logical processors available, using lower
  values only in cases where there are user-agent specific limits in place (such as a limitation
  on the number of <a href=#worker id=navigator.hardwareconcurrency:worker>workers</a> that can be created) or when the user agent
  desires to limit fingerprinting possibilities.</p>

  


  <h3 id=worker-中可用的-api><span class=secno>10.3</span> Worker 中可用的 API<a href=#worker-中可用的-api class=self-link></a></h3>
<div data-zh-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" data-en-date="Thu Mar 01 2018 15:51:30 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/web-workers/apis-available-to-workers/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/apis-available-to-workers/index.en.html></div>

  


  <h4 id=importing-scripts-and-libraries><span class=secno>10.3.1</span> Importing scripts and libraries<a href=#importing-scripts-and-libraries class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/apis-available-to-workers/importing-scripts-and-libraries.zh.html?filename=importing-scripts-and-libraries.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Fapis-available-to-workers%2Fimporting-scripts-and-libraries.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/apis-available-to-workers/importing-scripts-and-libraries.en.html></div>

  <p>When a script invokes the <dfn id=dom-workerglobalscope-importscripts><code>importScripts(<var>urls</var>)</code></dfn> method on
  a <code id=importing-scripts-and-libraries:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> object, the user agent must <a href=#import-scripts-into-worker-global-scope id=importing-scripts-and-libraries:import-scripts-into-worker-global-scope>import scripts into worker
  global scope</a> given this <code id=importing-scripts-and-libraries:workerglobalscope-2><a href=#workerglobalscope>WorkerGlobalScope</a></code> object and <var>urls</var>.</p>

  <p>To <dfn id=import-scripts-into-worker-global-scope data-export="">import scripts into worker global scope</dfn>, given a
  <code id=importing-scripts-and-libraries:workerglobalscope-3><a href=#workerglobalscope>WorkerGlobalScope</a></code> object <var>worker global scope</var> and a <code>sequence&lt;DOMString></code> <var>urls</var>, run these steps. The algorithm may
  optionally be customized by supplying custom <a href=webappapis.html#fetching-scripts-perform-fetch id=importing-scripts-and-libraries:fetching-scripts-perform-fetch>perform
  the fetch</a> hooks, which if provided will be used when invoking <a id=importing-scripts-and-libraries:fetch-a-classic-worker-imported-script href=webappapis.html#fetch-a-classic-worker-imported-script>fetch a classic
  worker-imported script</a>.</p>

  <ol><li><p>If <var>worker global scope</var>'s <a href=#concept-workerglobalscope-type id=importing-scripts-and-libraries:concept-workerglobalscope-type>type</a> is "<code>module</code>", throw a
   <code id=importing-scripts-and-libraries:typeerror><a data-x-internal=typeerror href=https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.<li><p>Let <var>settings object</var> be the <a id=importing-scripts-and-libraries:current-settings-object href=webappapis.html#current-settings-object>current settings object</a>.<li><p>If <var>urls</var> is empty, return.<li><p><a href=infrastructure.html#parse-a-url id=importing-scripts-and-libraries:parse-a-url>Parse</a> each value in <var>urls</var> relative to
   <var>settings object</var>. If any fail, throw a <a id=importing-scripts-and-libraries:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=importing-scripts-and-libraries:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
    <p>For each <var>url</var> in the <a href=infrastructure.html#resulting-url-record id=importing-scripts-and-libraries:resulting-url-record>resulting URL
    records</a>, run these substeps:</p>

    <ol><li><p><a id=importing-scripts-and-libraries:fetch-a-classic-worker-imported-script-2 href=webappapis.html#fetch-a-classic-worker-imported-script>Fetch a classic worker-imported script</a> given <var>url</var> and
     <var>settings object</var>, passing along any custom <a href=webappapis.html#fetching-scripts-perform-fetch id=importing-scripts-and-libraries:fetching-scripts-perform-fetch-2>perform the fetch</a> steps provided. If this
     succeeds, let <var>script</var> be the result. Otherwise, rethrow the exception.<li>
      <p><a href=webappapis.html#run-a-classic-script id=importing-scripts-and-libraries:run-a-classic-script>Run the classic script</a> <var>script</var>, with
      the rethrow errors argument set to true.</p>

      <p class=note><var>script</var> will run until it either returns, fails to parse, fails to
      catch an exception, or gets <a href=webappapis.html#abort-a-running-script id=importing-scripts-and-libraries:abort-a-running-script>prematurely aborted</a>
      by the <a href=#terminate-a-worker id=importing-scripts-and-libraries:terminate-a-worker>terminate a worker</a> algorithm defined above.</p>

      <p>If an exception was thrown or if the script was <a href=webappapis.html#abort-a-running-script id=importing-scripts-and-libraries:abort-a-running-script-2>prematurely aborted</a>, then abort all these steps, letting the exception or
      aborting continue to be processed by the calling <a href=webappapis.html#concept-script id=importing-scripts-and-libraries:concept-script>script</a>.</p>
     </ol>
   </ol>

  <p class=note><cite>Service Workers</cite> is an example of a specification that runs this
  algorithm with its own options for the <a href=webappapis.html#fetching-scripts-perform-fetch id=importing-scripts-and-libraries:fetching-scripts-perform-fetch-3>perform the
  fetch</a> hook. <a href=references.html#refsSW>[SW]</a></p>

  



  <h4 id=the-workernavigator-object><span class=secno>10.3.2</span> The <code id=workernavigator-dev><a href=#workernavigator>WorkerNavigator</a></code> interface<a href=#the-workernavigator-object class=self-link></a></h4><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerNavigator title="The WorkerNavigator interface represents a subset of the Navigator interface allowed to be accessed from a Worker. Such an object is initialized for each worker and is available via the WorkerGlobalScope.navigator property obtained by calling self.navigator.">WorkerNavigator</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/apis-available-to-workers/the-workernavigator-interface.zh.html?filename=the-workernavigator-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Fapis-available-to-workers%2Fthe-workernavigator-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/apis-available-to-workers/the-workernavigator-interface.en.html></div>

  

  <p>The <dfn data-dfn-for=WorkerGlobalScope id=dom-worker-navigator data-dfn-type=attribute><code>navigator</code></dfn> attribute of the
  <code id=the-workernavigator-object:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> interface must return an instance of the
  <code id=the-workernavigator-object:workernavigator><a href=#workernavigator>WorkerNavigator</a></code> interface, which represents the identity and state of the user agent
  (the client):</p>

  

  <pre><code class=idl>[Exposed=Worker]
interface <dfn id=workernavigator>WorkerNavigator</dfn> {};
<a href=#workernavigator id=the-workernavigator-object:workernavigator-2>WorkerNavigator</a> includes <a id=the-workernavigator-object:navigatorid href=system-state.html#navigatorid>NavigatorID</a>;
<a href=#workernavigator id=the-workernavigator-object:workernavigator-3>WorkerNavigator</a> includes <a id=the-workernavigator-object:navigatorlanguage href=system-state.html#navigatorlanguage>NavigatorLanguage</a>;
<a href=#workernavigator id=the-workernavigator-object:workernavigator-4>WorkerNavigator</a> includes <a id=the-workernavigator-object:navigatoronline href=offline.html#navigatoronline>NavigatorOnLine</a>;
<a href=#workernavigator id=the-workernavigator-object:workernavigator-5>WorkerNavigator</a> includes <a href=#navigatorconcurrenthardware id=the-workernavigator-object:navigatorconcurrenthardware>NavigatorConcurrentHardware</a>;</code></pre>

  


  <h4 id=worker-locations><span class=secno>10.3.3</span> The <code id=workerlocation-dev><a href=#workerlocation>WorkerLocation</a></code> interface<a href=#worker-locations class=self-link></a></h4><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation title="The WorkerLocation interface defines the absolute location of the script executed by the Worker. Such an object is initialized for each worker and is available via the WorkerGlobalScope.location property obtained by calling self.location.">WorkerLocation</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/web-workers/apis-available-to-workers/the-workerlocation-interface.zh.html?filename=the-workerlocation-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fweb-workers%2Fapis-available-to-workers%2Fthe-workerlocation-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/web-workers/apis-available-to-workers/the-workerlocation-interface.en.html></div>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/toString title="The toString() stringifier method of a WorkerLocation object returns a USVString containing the serialized URL for the worker’s location. It is a synonym for WorkerLocation.href.">WorkerLocation/toString</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><pre><code class=idl>[Exposed=Worker]
interface <dfn id=workerlocation>WorkerLocation</dfn> {
  stringifier readonly attribute USVString <a href=#dom-workerlocation-href id=worker-locations:dom-workerlocation-href>href</a>;
  readonly attribute USVString <a href=#dom-workerlocation-origin id=worker-locations:dom-workerlocation-origin>origin</a>;
  readonly attribute USVString <a href=#dom-workerlocation-protocol id=worker-locations:dom-workerlocation-protocol>protocol</a>;
  readonly attribute USVString <a href=#dom-workerlocation-host id=worker-locations:dom-workerlocation-host>host</a>;
  readonly attribute USVString <a href=#dom-workerlocation-hostname id=worker-locations:dom-workerlocation-hostname>hostname</a>;
  readonly attribute USVString <a href=#dom-workerlocation-port id=worker-locations:dom-workerlocation-port>port</a>;
  readonly attribute USVString <a href=#dom-workerlocation-pathname id=worker-locations:dom-workerlocation-pathname>pathname</a>;
  readonly attribute USVString <a href=#dom-workerlocation-search id=worker-locations:dom-workerlocation-search>search</a>;
  readonly attribute USVString <a href=#dom-workerlocation-hash id=worker-locations:dom-workerlocation-hash>hash</a>;
};</code></pre>

  

  

  <p>A <code id=worker-locations:workerlocation><a href=#workerlocation>WorkerLocation</a></code> object has an associated <dfn id=concept-workerlocation-workerglobalscope><code>WorkerGlobalScope</code> object</dfn> (a
  <code id=worker-locations:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> object).

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/href title="The href property of a WorkerLocation object returns a USVString containing the serialized URL for the worker’s location.">WorkerLocation/href</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-href><code>href</code></dfn> attribute's getter must
  return the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope><code>WorkerGlobalScope</code> object</a>'s
  <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url>url</a>, <a href=https://url.spec.whatwg.org/#concept-url-serializer id=worker-locations:concept-url-serializer data-x-internal=concept-url-serializer>serialized</a>.</p>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/origin title="The origin property of a WorkerLocation object returns the worker’s origin.">WorkerLocation/origin</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-origin><code>origin</code></dfn> attribute's getter must
  return the <a href=origin.html#ascii-serialisation-of-an-origin id=worker-locations:ascii-serialisation-of-an-origin>serialization</a> of the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-2><code>WorkerGlobalScope</code> object</a>'s
  <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-2>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-origin id=worker-locations:concept-url-origin data-x-internal=concept-url-origin>origin</a>.</p>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/protocol title="The protocol property of a WorkerLocation object returns the protocol part of the worker’s location.">WorkerLocation/protocol</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-protocol><code>protocol</code></dfn> attribute's getter
  must return the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-3><code>WorkerGlobalScope</code> object</a>'s
  <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-3>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=worker-locations:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>, followed by "<code>:</code>".</p>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/host title="The host property of a WorkerLocation object returns the host part of the worker’s location.">WorkerLocation/host</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-host><code>host</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>Let <var>url</var> be the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-4><code>WorkerGlobalScope</code> object</a>'s
   <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-4>url</a>.<li><p>If <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=worker-locations:concept-url-host data-x-internal=concept-url-host>host</a> is null, return the empty
   string.<li><p>If <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=worker-locations:concept-url-port data-x-internal=concept-url-port>port</a> is null, return
   <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=worker-locations:concept-url-host-2 data-x-internal=concept-url-host>host</a>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=worker-locations:host-serializer data-x-internal=host-serializer>serialized</a>.<li><p>Return <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=worker-locations:concept-url-host-3 data-x-internal=concept-url-host>host</a>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=worker-locations:host-serializer-2 data-x-internal=host-serializer>serialized</a>, followed by "<code>:</code>" and <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=worker-locations:concept-url-port-2 data-x-internal=concept-url-port>port</a>, <a href=https://url.spec.whatwg.org/#serialize-an-integer id=worker-locations:serialize-an-integer data-x-internal=serialize-an-integer>serialized</a>.</ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/hostname title="The hostname property of a WorkerLocation object returns the hostname part of the worker’s location.">WorkerLocation/hostname</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-hostname><code>hostname</code></dfn> attribute's getter
  must run these steps:</p>

  <ol><li><p>Let <var>host</var> be the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-5><code>WorkerGlobalScope</code> object</a>'s
   <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-5>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=worker-locations:concept-url-host-4 data-x-internal=concept-url-host>host</a>.<li><p>If <var>host</var> is null, return the empty string.<li><p>Return <var>host</var>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=worker-locations:host-serializer-3 data-x-internal=host-serializer>serialized</a>.</ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/port title="The port property of a WorkerLocation object returns the port part of the worker’s location.">WorkerLocation/port</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-port><code>port</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>Let <var>port</var> be the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-6><code>WorkerGlobalScope</code> object</a>'s
   <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-6>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=worker-locations:concept-url-port-3 data-x-internal=concept-url-port>port</a>.<li><p>If <var>port</var> is null, return the empty string.<li><p>Return <var>port</var>, <a href=https://url.spec.whatwg.org/#serialize-an-integer id=worker-locations:serialize-an-integer-2 data-x-internal=serialize-an-integer>serialized</a>.</ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/pathname title="The pathname property of a WorkerLocation object returns the pathname part of the worker’s location.">WorkerLocation/pathname</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-pathname><code>pathname</code></dfn> attribute's getter
  must run these steps:</p>

  <ol><li><p>Let <var>url</var> be the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-7><code>WorkerGlobalScope</code> object</a>'s
   <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-7>url</a>.<li><p>If <var>url</var>'s <a id=worker-locations:cannot-be-a-base-url-flag href=https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, return the first string
   in <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-path id=worker-locations:concept-url-path data-x-internal=concept-url-path>path</a>.<li><p>Return "<code>/</code>", followed by the strings in <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-path id=worker-locations:concept-url-path-2 data-x-internal=concept-url-path>path</a> (including empty strings), separated from each other by
   "<code>/</code>".</ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/search title="The search property of a WorkerLocation object returns the search part of the worker’s location.">WorkerLocation/search</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-search><code>search</code></dfn> attribute's getter must
  run these steps:</p>

  <ol><li><p>Let <var>query</var> be the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-8><code>WorkerGlobalScope</code> object</a>'s
   <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-8>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-query id=worker-locations:concept-url-query data-x-internal=concept-url-query>query</a>.<li><p>If <var>query</var> is either null or the empty string, return the empty string.<li><p>Return "<code>?</code>", followed by <var>query</var>.</ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation/hash title="The hash property of a WorkerLocation object returns the hash part of the worker’s location.">WorkerLocation/hash</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id=dom-workerlocation-hash><code>hash</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>Let <var>fragment</var> be the associated <a href=#concept-workerlocation-workerglobalscope id=worker-locations:concept-workerlocation-workerglobalscope-9><code>WorkerGlobalScope</code> object</a>'s
   <a href=#concept-workerglobalscope-url id=worker-locations:concept-workerglobalscope-url-9>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=worker-locations:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a>.<li><p>If <var>fragment</var> is either null or the empty string, return the empty string.<li><p>Return "<code>#</code>", followed by <var>fragment</var>.</ol>

  



  <nav><a href=web-messaging.html>← 9.4 跨文档通信</a> — <a href=./>Table of Contents</a> — <a href=worklets.html>11 Worklets →</a></nav>
<script src=/html/resources/zh-cn.js></script>
